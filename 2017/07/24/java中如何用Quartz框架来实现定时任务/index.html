<!DOCTYPE html>


  <html class="light page-post">


<head>
  <meta charset="utf-8">
  
  <title>java中如何用Quartz框架来实现定时任务 | Sai&#39;s Note</title>

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
    <meta name="keywords" content="sai,前端,前端开发,用户体验,frontend,ruby,JavaScript,vue,python" />
  

  <meta name="description" content="一 基本语法Quartz是OpenSymphony开源组织在Job scheduling领域又一个开源项目，它可以与J2EE与J2SE应用程序相结合也可以单独使用。Quartz可以用来创建简单或为运行十个，百个，甚至是好几万个Jobs这样复杂的程序。而我们在写Java程序中经常会写一些定时执行的任务，比如某月的几号去执行一件事，每天的凌晨做些什么，或者每天执行一次什么方法，接下来我把简单的Quar">
<meta property="og:type" content="article">
<meta property="og:title" content="java中如何用Quartz框架来实现定时任务">
<meta property="og:url" content="http://example.com/2017/07/24/java%E4%B8%AD%E5%A6%82%E4%BD%95%E7%94%A8Quartz%E6%A1%86%E6%9E%B6%E6%9D%A5%E5%AE%9E%E7%8E%B0%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/index.html">
<meta property="og:site_name" content="Sai&#39;s Note">
<meta property="og:description" content="一 基本语法Quartz是OpenSymphony开源组织在Job scheduling领域又一个开源项目，它可以与J2EE与J2SE应用程序相结合也可以单独使用。Quartz可以用来创建简单或为运行十个，百个，甚至是好几万个Jobs这样复杂的程序。而我们在写Java程序中经常会写一些定时执行的任务，比如某月的几号去执行一件事，每天的凌晨做些什么，或者每天执行一次什么方法，接下来我把简单的Quar">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/images/1336098-6f0f9972ff5bc94e.png">
<meta property="og:image" content="http://example.com/images/1336098-6b80a64e5c6218da.png">
<meta property="og:image" content="http://example.com/images/1336098-dd2220cd9b3a060a.png">
<meta property="og:image" content="http://example.com/images/1336098-96764ecd7465bc61.png">
<meta property="og:image" content="http://example.com/images/1336098-cc02d40686170d4c.png">
<meta property="og:image" content="http://example.com/images/1336098-4566a53f60e12add.png">
<meta property="og:image" content="http://example.com/images/1336098-b3b94fe27850ae0a.png">
<meta property="og:image" content="http://example.com/images/1336098-53754ba1171f5941.png">
<meta property="og:image" content="http://example.com/images/1336098-914f589e42c81af1.png">
<meta property="og:image" content="http://example.com/images/1336098-97a9ab3928886b60.png">
<meta property="article:published_time" content="2017-07-24T13:57:59.000Z">
<meta property="article:modified_time" content="2021-01-05T04:06:28.775Z">
<meta property="article:author" content="sai">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/images/1336098-6f0f9972ff5bc94e.png">

  

  
    <link rel="icon" href="/favicon.ico">
  

  <link href="/css/styles.css?v=c114cbeddx" rel="stylesheet">


  
    
<link rel="stylesheet" href="/css/personal-style.css">

  

  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-38189205-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


  
  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?57e94d016e201fba3603a8a2b0263af0";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>


  
  <script type="text/javascript">
	(function(){
	    var bp = document.createElement('script');
	    var curProtocol = window.location.protocol.split(':')[0];
	    if (curProtocol === 'https') {
	        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
	    }
	    else {
	        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
	    }
	    var s = document.getElementsByTagName("script")[0];
	    s.parentNode.insertBefore(bp, s);
	})();
  </script>



  
    <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.3.0/css/font-awesome.min.css">
  

<meta name="generator" content="Hexo 5.3.0"></head>

<body>


  
    <span id="toolbox-mobile" class="toolbox-mobile">盒子</span>
  

  <div class="post-header CENTER">
   
  <div class="toolbox">
    <a class="toolbox-entry" href="/">
      <span class="toolbox-entry-text">盒子</span>
      <i class="icon-angle-down"></i>
      <i class="icon-home"></i>
    </a>
    <ul class="list-toolbox">
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/archives/"
            rel="noopener noreferrer"
            target="_self"
            >
            博客
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/category/"
            rel="noopener noreferrer"
            target="_self"
            >
            分类
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/tag/"
            rel="noopener noreferrer"
            target="_self"
            >
            标签
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/about/"
            rel="noopener noreferrer"
            target="_self"
            >
            关于
          </a>
        </li>
      
    </ul>
  </div>


</div>


  <div id="toc" class="toc-article">
    <strong class="toc-title">文章目录</strong>
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80-%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95"><span class="toc-text">一 基本语法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C-%E5%85%B7%E4%BD%93%E5%AE%9E%E7%8E%B0"><span class="toc-text">二 具体实现</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89-%E5%A6%82%E4%BD%95%E7%94%A8Quartz%E6%A1%86%E6%9E%B6%E8%AE%BE%E7%BD%AE%E5%8F%AA%E6%9C%89%E4%B8%80%E4%B8%AA%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E4%BD%86%E6%98%AF%E5%8F%AF%E4%BB%A5%E5%A4%9A%E4%B8%AA%E6%97%B6%E9%97%B4%E6%AE%B5%E6%9D%A5%E6%89%A7%E8%A1%8C"><span class="toc-text">三 如何用Quartz框架设置只有一个定时任务但是可以多个时间段来执行</span></a></li></ol>
  </div>



<div class="content content-post CENTER">
   <article id="post-java中如何用Quartz框架来实现定时任务" class="article article-type-post" itemprop="blogPost">
  <header class="article-header">
    <h1 class="post-title">java中如何用Quartz框架来实现定时任务</h1>

    <div class="article-meta">
      <span>
        <i class="icon-calendar"></i>
        <span>2017.07.24</span>
      </span>

      
        <span class="article-author">
          <i class="icon-user"></i>
          <span>sai</span>
        </span>
      

      


      
        <span>
          <i class="icon-comment"></i>
          <a target="_blank" rel="noopener" href="https://showmecode.cc//2017/07/24/java%E4%B8%AD%E5%A6%82%E4%BD%95%E7%94%A8Quartz%E6%A1%86%E6%9E%B6%E6%9D%A5%E5%AE%9E%E7%8E%B0%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/#disqus_thread"></a>
        </span>
      

      
      <i class="fa fa-eye"></i> 
        <span id="busuanzi_container_page_pv">
           &nbsp热度 <span id="busuanzi_value_page_pv">
           <i class="fa fa-spinner fa-spin"></i></span>℃
        </span>
      
      
    </div>
  </header>

  <div class="article-content">
    
      <h2 id="一-基本语法"><a href="#一-基本语法" class="headerlink" title="一 基本语法"></a>一 基本语法</h2><p>Quartz是OpenSymphony开源组织在Job scheduling领域又一个开源项目，它可以与J2EE与J2SE应用程序相结合也可以单独使用。Quartz可以用来创建简单或为运行十个，百个，甚至是好几万个Jobs这样复杂的程序。而我们在写Java程序中经常会写一些定时执行的任务，比如某月的几号去执行一件事，每天的凌晨做些什么，或者每天执行一次什么方法，接下来我把简单的Quartz入门实例放进来，是可以直接运行，是对Quartz的增删改查系列，可以对于初学者，有个大概的了解。</p>
<p>这里直接放代码，看效果：</p>
<p>QuartzManager（增删改查方法）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line">package com.joyce.quartz;  </span><br><span class="line">  </span><br><span class="line">import org.quartz.CronTrigger;  </span><br><span class="line">import org.quartz.JobDetail;  </span><br><span class="line">import org.quartz.Scheduler;  </span><br><span class="line">import org.quartz.SchedulerFactory;  </span><br><span class="line">import org.quartz.impl.StdSchedulerFactory;  </span><br><span class="line">  </span><br><span class="line">public class QuartzManager &#123;  </span><br><span class="line">    private static SchedulerFactory gSchedulerFactory &#x3D; new StdSchedulerFactory();  </span><br><span class="line">    private static String JOB_GROUP_NAME &#x3D; &quot;EXTJWEB_JOBGROUP_NAME&quot;;  </span><br><span class="line">    private static String TRIGGER_GROUP_NAME &#x3D; &quot;EXTJWEB_TRIGGERGROUP_NAME&quot;;  </span><br><span class="line">  </span><br><span class="line">    &#x2F;** </span><br><span class="line">     * 添加一个定时任务，使用默认的任务组名，触发器名，触发器组名 </span><br><span class="line">     * @param jobName 任务名 </span><br><span class="line">     * @param cls 任务 </span><br><span class="line">     * @param time 时间设置 </span><br><span class="line">     *&#x2F;  </span><br><span class="line">    @SuppressWarnings(&quot;rawtypes&quot;)  </span><br><span class="line">    public static void addJob(String jobName, Class cls, String time) &#123;  </span><br><span class="line">        try &#123;  </span><br><span class="line">            Scheduler sched &#x3D; gSchedulerFactory.getScheduler();  </span><br><span class="line">            &#x2F;&#x2F; 任务名，任务组，任务执行类  </span><br><span class="line">            JobDetail jobDetail &#x3D; new JobDetail(jobName, JOB_GROUP_NAME, cls);  </span><br><span class="line">            &#x2F;&#x2F;可以传递参数  </span><br><span class="line">            jobDetail.getJobDataMap().put(&quot;param&quot;, &quot;railsboy&quot;);  </span><br><span class="line">            &#x2F;&#x2F; 触发器  </span><br><span class="line">            CronTrigger trigger &#x3D; new CronTrigger(jobName, TRIGGER_GROUP_NAME);  </span><br><span class="line">            &#x2F;&#x2F; 触发器名,触发器组  </span><br><span class="line">            trigger.setCronExpression(time);  </span><br><span class="line">            &#x2F;&#x2F; 触发器时间设定  </span><br><span class="line">            sched.scheduleJob(jobDetail, trigger);  </span><br><span class="line">            &#x2F;&#x2F; 启动  </span><br><span class="line">            if (!sched.isShutdown()) &#123;  </span><br><span class="line">                sched.start();  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125; catch (Exception e) &#123;  </span><br><span class="line">            throw new RuntimeException(e);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">    &#x2F;** </span><br><span class="line">     * 修改一个任务的触发时间(使用默认的任务组名，触发器名，触发器组名) </span><br><span class="line">     * @param jobName </span><br><span class="line">     * @param time </span><br><span class="line">     *&#x2F;  </span><br><span class="line">    @SuppressWarnings(&quot;rawtypes&quot;)  </span><br><span class="line">    public static void modifyJobTime(String jobName, String time) &#123;  </span><br><span class="line">        try &#123;  </span><br><span class="line">            Scheduler sched &#x3D; gSchedulerFactory.getScheduler();  </span><br><span class="line">            CronTrigger trigger &#x3D; (CronTrigger) sched.getTrigger(jobName,TRIGGER_GROUP_NAME);  </span><br><span class="line">            if (trigger &#x3D;&#x3D; null) &#123;  </span><br><span class="line">                return;  </span><br><span class="line">            &#125;  </span><br><span class="line">            String oldTime &#x3D; trigger.getCronExpression();  </span><br><span class="line">            if (!oldTime.equalsIgnoreCase(time)) &#123;  </span><br><span class="line">                JobDetail jobDetail &#x3D; sched.getJobDetail(jobName,JOB_GROUP_NAME);  </span><br><span class="line">                Class objJobClass &#x3D; jobDetail.getJobClass();  </span><br><span class="line">                removeJob(jobName);  </span><br><span class="line">                addJob(jobName, objJobClass, time);  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125; catch (Exception e) &#123;  </span><br><span class="line">            throw new RuntimeException(e);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">    &#x2F;** </span><br><span class="line">     * 移除一个任务(使用默认的任务组名，触发器名，触发器组名) </span><br><span class="line">     * @param jobName </span><br><span class="line">     *&#x2F;  </span><br><span class="line">    public static void removeJob(String jobName) &#123;  </span><br><span class="line">        try &#123;  </span><br><span class="line">            Scheduler sched &#x3D; gSchedulerFactory.getScheduler();  </span><br><span class="line">            sched.pauseTrigger(jobName, TRIGGER_GROUP_NAME);&#x2F;&#x2F; 停止触发器  </span><br><span class="line">            sched.unscheduleJob(jobName, TRIGGER_GROUP_NAME);&#x2F;&#x2F; 移除触发器  </span><br><span class="line">            sched.deleteJob(jobName, JOB_GROUP_NAME);&#x2F;&#x2F; 删除任务  </span><br><span class="line">        &#125; catch (Exception e) &#123;  </span><br><span class="line">            throw new RuntimeException(e);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    &#x2F;** </span><br><span class="line">     * 启动所有定时任务 </span><br><span class="line">     *&#x2F;  </span><br><span class="line">    public static void startJobs() &#123;  </span><br><span class="line">        try &#123;  </span><br><span class="line">            Scheduler sched &#x3D; gSchedulerFactory.getScheduler();  </span><br><span class="line">            sched.start();  </span><br><span class="line">        &#125; catch (Exception e) &#123;  </span><br><span class="line">            throw new RuntimeException(e);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    &#x2F;** </span><br><span class="line">     * 关闭所有定时任务 </span><br><span class="line">     *&#x2F;  </span><br><span class="line">    public static void shutdownJobs() &#123;  </span><br><span class="line">        try &#123;  </span><br><span class="line">            Scheduler sched &#x3D; gSchedulerFactory.getScheduler();  </span><br><span class="line">            if (!sched.isShutdown()) &#123;  </span><br><span class="line">                sched.shutdown();  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125; catch (Exception e) &#123;  </span><br><span class="line">            throw new RuntimeException(e);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>
<p>QuartzJob（任务执行类）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">package com.joyce.quartz;  </span><br><span class="line">  </span><br><span class="line">import java.text.SimpleDateFormat;  </span><br><span class="line">import java.util.Date;  </span><br><span class="line">  </span><br><span class="line">import org.quartz.Job;  </span><br><span class="line">import org.quartz.JobDataMap;  </span><br><span class="line">import org.quartz.JobExecutionContext;  </span><br><span class="line">import org.quartz.JobExecutionException;  </span><br><span class="line">  </span><br><span class="line">&#x2F;** </span><br><span class="line"> * 任务执行类 </span><br><span class="line"> *&#x2F;  </span><br><span class="line">public class QuartzJob implements Job &#123;  </span><br><span class="line">  </span><br><span class="line">    @Override  </span><br><span class="line">    public void execute(JobExecutionContext content) throws JobExecutionException &#123;  </span><br><span class="line">        System.out.println(new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;).format(new Date())+ &quot;★★★★★★★★★★★&quot;);    </span><br><span class="line">        String jobName &#x3D; content.getJobDetail().getName();  </span><br><span class="line">        JobDataMap dataMap &#x3D; content.getJobDetail().getJobDataMap();  </span><br><span class="line">        String param &#x3D; dataMap.getString(&quot;param&quot;);  </span><br><span class="line">        System.out.println(&quot;传递的参数是&#x3D;&quot;+param +&quot;任务名字是&#x3D;&quot;+jobName);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>
<p>QuartzTest（定时任务测试类）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">package com.joyce.quartz.main;  </span><br><span class="line">  </span><br><span class="line">import java.text.SimpleDateFormat;  </span><br><span class="line">import java.util.Date;  </span><br><span class="line">  </span><br><span class="line">import com.joyce.quartz.QuartzJob;  </span><br><span class="line">import com.joyce.quartz.QuartzManager;  </span><br><span class="line">  </span><br><span class="line">public class QuartzTest &#123;  </span><br><span class="line">    public static void main(String[] args) &#123;  </span><br><span class="line">        try &#123;  </span><br><span class="line">            String job_name &#x3D; &quot;动态任务调度&quot;;  </span><br><span class="line">            System.out.println(&quot;【任务启动】开始(每10秒输出一次)...&quot;);    </span><br><span class="line">            QuartzManager.addJob(job_name, QuartzJob.class, &quot;0&#x2F;10 * * * * ?&quot;);  </span><br><span class="line">            Thread.sleep(5000);  </span><br><span class="line">            System.out.println(&quot;【修改时间】开始(每2秒输出一次)...&quot;);    </span><br><span class="line">            QuartzManager.modifyJobTime(job_name, &quot;10&#x2F;2 * * * * ?&quot;);    </span><br><span class="line">            Thread.sleep(6000);    </span><br><span class="line">            System.out.println(&quot;【移除定时】开始...&quot;);    </span><br><span class="line">            QuartzManager.removeJob(job_name);    </span><br><span class="line">            System.out.println(&quot;【移除定时】成功&quot;);    </span><br><span class="line">            System.out.println(&quot;【再次添加定时任务】开始(每10秒输出一次)...&quot;);    </span><br><span class="line">            QuartzManager.addJob(job_name, QuartzJob.class, &quot;*&#x2F;10 * * * * ?&quot;);    </span><br><span class="line">            Thread.sleep(60000);    </span><br><span class="line">            System.out.println(&quot;【移除定时】开始...&quot;);    </span><br><span class="line">            QuartzManager.removeJob(job_name);    </span><br><span class="line">            System.out.println(&quot;【移除定时】成功&quot;);  </span><br><span class="line">        &#125; catch (Exception e) &#123;  </span><br><span class="line">            e.printStackTrace();  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">      </span><br><span class="line">    public static String formatDateByPattern(Date date,String dateFormat)&#123;    </span><br><span class="line">        SimpleDateFormat sdf &#x3D; new SimpleDateFormat(dateFormat);    </span><br><span class="line">        String formatTimeStr &#x3D; null;    </span><br><span class="line">        if (date !&#x3D; null) &#123;    </span><br><span class="line">            formatTimeStr &#x3D; sdf.format(date);    </span><br><span class="line">        &#125;    </span><br><span class="line">        return formatTimeStr;    </span><br><span class="line">    &#125;    </span><br><span class="line">    public static String getCron(java.util.Date  date)&#123;    </span><br><span class="line">        String dateFormat&#x3D;&quot;ss mm HH dd MM ? yyyy&quot;;    </span><br><span class="line">        return formatDateByPattern(date, dateFormat);    </span><br><span class="line">     &#125;    </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>
<p>console执行效果：</p>
<p><img src="/images/1336098-6f0f9972ff5bc94e.png" alt="mylife.png"></p>
<p>常用的时间配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">格式: [秒] [分] [小时] [日] [月] [周] [年]0 0 12 * * ?           </span><br><span class="line">每天12点触发 0 15 10 ? * *          </span><br><span class="line">每天10点15分触发 0 15 10 * * ?          </span><br><span class="line">每天10点15分触发  0 15 10 * * ? *        </span><br><span class="line">每天10点15分触发  0 15 10 * * ? 2005     </span><br><span class="line">2005年每天10点15分触发 0 * 14 * * ?           </span><br><span class="line">每天下午的 2点到2点59分每分触发 0 0&#x2F;5 14 * * ?         </span><br><span class="line">每天下午的 2点到2点59分(整点开始，每隔5分触发)  0 0&#x2F;5 14,18 * * ?        </span><br><span class="line">每天下午的 18点到18点59分(整点开始，每隔5分触发)0 0-5 14 * * ?            </span><br><span class="line">每天下午的 2点到2点05分每分触发 0 10,44 14 ? 3 WED        </span><br><span class="line">3月分每周三下午的 2点10分和2点44分触发 0 15 10 ? * MON-FRI       </span><br><span class="line">从周一到周五每天上午的10点15分触发 0 15 10 15 * ?            </span><br><span class="line">每月15号上午10点15分触发 0 15 10 L * ?             </span><br><span class="line">每月最后一天的10点15分触发 0 15 10 ? * 6L            </span><br><span class="line">每月最后一周的星期五的10点15分触发 0 15 10 ? * 6L 2002-2005  </span><br><span class="line">从2002年到2005年每月最后一周的星期五的10点15分触发0 15 10 ? * 6#3每月的第三周的星期五开始触发 0 0 12 1&#x2F;5 * ?            </span><br><span class="line">每月的第一个中午开始每隔5天触发一次 0 11 11 11 11 ?           </span><br><span class="line">每年的11月11号 11点11分触发(光棍节)</span><br></pre></td></tr></table></figure>


<h2 id="二-具体实现"><a href="#二-具体实现" class="headerlink" title="二 具体实现"></a>二 具体实现</h2><p>之前做的项目中有五个平台，分别是出版平台、图书馆平台、发行平台、零售平台、中心平台。</p>
<ul>
<li>出版平台：主要是录入图书信息和图书的相关图片和附件信息</li>
<li>图书馆平台：将出版发送过来的图书进行借阅和副本的录入</li>
<li>发布平台和零售平台：给图书录入订购、销售、库存的数量的信息</li>
<li>中心平台：跟前台页面进行交互（管理前台页面）</li>
</ul>
<p><strong>需求一：</strong>在中心平台中，信息发布管理模块有4个管理，分别是：首页大图管理、行业信息管理、友情链接管理、文件发布管理，除了在原有的手动发布（后台点击发布，前台会展示后台所发布的信息）的基础上，实现定时发布效果（自己设置任意时间，系统会根据你设置的时间来进行发布）。</p>
<p>需求一页面效果：</p>
<p><img src="/images/1336098-6b80a64e5c6218da.png" alt="定时任务1.png"></p>
<p><img src="/images/1336098-dd2220cd9b3a060a.png" alt="定时任务2.png"></p>
<p><strong>需求二</strong>：出版、图书馆、发行、零售这四个平台的信息是可以相互传递的，如出版可以发送给图书馆、发行和零售，其他几个也可以发送给任何一个平台(点对点发送)，用的是消息队列(activemq)来实现了，也是这个项目的核心功能，这个也是，在原来手动发送的基础上，实现定时发送，这个要复杂一些，实现单独的模块，数据交换的策略管理，根据设置的要求和相应的时间，定时进行发送。</p>
<p>需求二页面效果：</p>
<p><img src="/images/1336098-96764ecd7465bc61.png" alt="20161229105107006.png"></p>
<p><img src="/images/1336098-cc02d40686170d4c.png" alt="20161229105224275.png"></p>
<p><img src="/images/1336098-4566a53f60e12add.png" alt="20161229105247604.png"></p>
<p><img src="/images/1336098-b3b94fe27850ae0a.png" alt="20161229105303194.png"></p>
<p>说明：这里可以根据通告类型、出版状态、接收对象(是发送给哪个平台，可以任意选择)、发送日期和时间进行定时发送</p>
<p>说明：这里我单独定义一个包，来写定时任务的代码<br>ScheduleJobController：（这里控制层没有在这写，因为，我要在具体的发送的controller来写，这里定义了出来，但是没有用到）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">package com.jetsen.quartz.controller;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">import org.springframework.stereotype.Controller;  </span><br><span class="line">import org.springframework.web.bind.annotation.RequestMapping;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">&#x2F;** </span><br><span class="line"> * @author sai </span><br><span class="line"> * @date 2016-07-25 </span><br><span class="line"> *&#x2F;  </span><br><span class="line">&#x2F;&#x2F;暂时用不到,定时分布在各个需要的模块中  </span><br><span class="line">@RequestMapping(&quot;schedule&quot;)  </span><br><span class="line">@Controller  </span><br><span class="line">public class ScheduleJobController &#123;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">&#125;&lt;strong&gt;  </span><br><span class="line">&lt;&#x2F;strong&gt; </span><br></pre></td></tr></table></figure>
<p>ScheduleJob：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br></pre></td><td class="code"><pre><span class="line">package com.jetsen.quartz.entity;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">import java.util.Date;  </span><br><span class="line">  </span><br><span class="line">import javax.persistence.CascadeType;  </span><br><span class="line">import javax.persistence.Column;  </span><br><span class="line">import javax.persistence.Entity;  </span><br><span class="line">import javax.persistence.GeneratedValue;  </span><br><span class="line">import javax.persistence.GenerationType;  </span><br><span class="line">import javax.persistence.Id;  </span><br><span class="line">import javax.persistence.JoinColumn;  </span><br><span class="line">import javax.persistence.ManyToOne;  </span><br><span class="line">import javax.persistence.Table;  </span><br><span class="line">  </span><br><span class="line">import org.hibernate.annotations.Cache;  </span><br><span class="line">import org.hibernate.annotations.CacheConcurrencyStrategy;  </span><br><span class="line">  </span><br><span class="line">import com.jetsen.model.book.Strategy;  </span><br><span class="line">  </span><br><span class="line">&#x2F;** </span><br><span class="line"> * @author sai </span><br><span class="line"> * @date 2016-07-25 </span><br><span class="line"> *&#x2F;  </span><br><span class="line">@Entity  </span><br><span class="line">@Table(name &#x3D; &quot;task_scheduleJob&quot;)  </span><br><span class="line">public class ScheduleJob&#123;  </span><br><span class="line">    &#x2F;** 任务id *&#x2F;  </span><br><span class="line">    private Long   scheduleJobId;  </span><br><span class="line">    &#x2F;** 任务名称 *&#x2F;  </span><br><span class="line">    private String  jobName;  </span><br><span class="line">    &#x2F;** 任务别名 *&#x2F;  </span><br><span class="line">    private String  aliasName;  </span><br><span class="line">    &#x2F;** 任务分组 *&#x2F;  </span><br><span class="line">    private String  jobGroup;  </span><br><span class="line">    &#x2F;** 触发器 *&#x2F;  </span><br><span class="line">    private String  jobTrigger;  </span><br><span class="line">    &#x2F;** 任务状态 *&#x2F;  </span><br><span class="line">    private String    status;  </span><br><span class="line">    &#x2F;** 任务运行时间表达式 *&#x2F;  </span><br><span class="line">    private String  cronExpression;  </span><br><span class="line">    &#x2F;** 是否异步 *&#x2F;  </span><br><span class="line">    private boolean  isSync;  </span><br><span class="line">    &#x2F;** 任务描述 *&#x2F;  </span><br><span class="line">    private Long   description;  </span><br><span class="line">    &#x2F;** 创建时间 *&#x2F;  </span><br><span class="line">    private Date    gmtCreate;  </span><br><span class="line">    &#x2F;** 修改时间 *&#x2F;  </span><br><span class="line">    private Date  gmtModify;  </span><br><span class="line">    &#x2F;&#x2F;定时发送的方式  </span><br><span class="line">    private String sendStyle;  </span><br><span class="line">    &#x2F;&#x2F;这里方便展示   </span><br><span class="line">    private String  taskTime;  </span><br><span class="line">    private String descInfo;  </span><br><span class="line">    private String org_codes;  </span><br><span class="line">    private String org_names;  </span><br><span class="line">    private String publishState;  </span><br><span class="line">    private String notificationType;  </span><br><span class="line">    private Strategy strategy;  </span><br><span class="line">    @Id  </span><br><span class="line">    @GeneratedValue(strategy&#x3D;GenerationType.IDENTITY)  </span><br><span class="line">    @Column(name &#x3D; &quot;scheduleJobId&quot;, nullable &#x3D; false)  </span><br><span class="line">    public Long getScheduleJobId() &#123;  </span><br><span class="line">        return scheduleJobId;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public void setScheduleJobId(Long scheduleJobId) &#123;  </span><br><span class="line">        this.scheduleJobId &#x3D; scheduleJobId;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public String getJobName() &#123;  </span><br><span class="line">        return jobName;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public void setJobName(String jobName) &#123;  </span><br><span class="line">        this.jobName &#x3D; jobName;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public String getAliasName() &#123;  </span><br><span class="line">        return aliasName;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public void setAliasName(String aliasName) &#123;  </span><br><span class="line">        this.aliasName &#x3D; aliasName;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public String getJobGroup() &#123;  </span><br><span class="line">        return jobGroup;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public void setJobGroup(String jobGroup) &#123;  </span><br><span class="line">        this.jobGroup &#x3D; jobGroup;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public String getJobTrigger() &#123;  </span><br><span class="line">        return jobTrigger;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public void setJobTrigger(String jobTrigger) &#123;  </span><br><span class="line">        this.jobTrigger &#x3D; jobTrigger;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public String getStatus() &#123;  </span><br><span class="line">        return status;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public void setStatus(String status) &#123;  </span><br><span class="line">        this.status &#x3D; status;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public String getCronExpression() &#123;  </span><br><span class="line">        return cronExpression;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public void setCronExpression(String cronExpression) &#123;  </span><br><span class="line">        this.cronExpression &#x3D; cronExpression;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">     </span><br><span class="line">  </span><br><span class="line">    public Long getDescription() &#123;  </span><br><span class="line">        return description;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public void setDescription(Long description) &#123;  </span><br><span class="line">        this.description &#x3D; description;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public Date getGmtCreate() &#123;  </span><br><span class="line">        return gmtCreate;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public void setGmtCreate(Date gmtCreate) &#123;  </span><br><span class="line">        this.gmtCreate &#x3D; gmtCreate;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public Date getGmtModify() &#123;  </span><br><span class="line">        return gmtModify;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public void setGmtModify(Date gmtModify) &#123;  </span><br><span class="line">        this.gmtModify &#x3D; gmtModify;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public Boolean getIsSync() &#123;  </span><br><span class="line">        return isSync;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public void setIsSync(Boolean isSync) &#123;  </span><br><span class="line">        this.isSync &#x3D; isSync;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public String getTaskTime() &#123;  </span><br><span class="line">        return taskTime;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public void setTaskTime(String taskTime) &#123;  </span><br><span class="line">        this.taskTime &#x3D; taskTime;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public void setSync(boolean isSync) &#123;  </span><br><span class="line">        this.isSync &#x3D; isSync;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public String getSendStyle() &#123;  </span><br><span class="line">        return sendStyle;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public void setSendStyle(String sendStyle) &#123;  </span><br><span class="line">        this.sendStyle &#x3D; sendStyle;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public String getDescInfo() &#123;  </span><br><span class="line">        return descInfo;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public void setDescInfo(String descInfo) &#123;  </span><br><span class="line">        this.descInfo &#x3D; descInfo;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public String getOrg_codes() &#123;  </span><br><span class="line">        return org_codes;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public void setOrg_codes(String org_codes) &#123;  </span><br><span class="line">        this.org_codes &#x3D; org_codes;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public String getPublishState() &#123;  </span><br><span class="line">        return publishState;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public void setPublishState(String publishState) &#123;  </span><br><span class="line">        this.publishState &#x3D; publishState;  </span><br><span class="line">    &#125;  </span><br><span class="line">    @ManyToOne(cascade &#x3D; &#123;CascadeType.MERGE,CascadeType.REFRESH &#125;, optional &#x3D; true)   </span><br><span class="line">    @JoinColumn(name&#x3D;&quot;stratesaiId&quot;)  </span><br><span class="line">    @Cache(usage &#x3D; CacheConcurrencyStrategy.READ_WRITE)  </span><br><span class="line">    public Strategy getStrategy() &#123;  </span><br><span class="line">        return strategy;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public void setStrategy(Strategy strategy) &#123;  </span><br><span class="line">        this.strategy &#x3D; strategy;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public String getNotificationType() &#123;  </span><br><span class="line">        return notificationType;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public void setNotificationType(String notificationType) &#123;  </span><br><span class="line">        this.notificationType &#x3D; notificationType;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public String getOrg_names() &#123;  </span><br><span class="line">        return org_names;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public void setOrg_names(String org_names) &#123;  </span><br><span class="line">        this.org_names &#x3D; org_names;  </span><br><span class="line">    &#125;       </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<p>ScheduleJobInit：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">package com.jetsen.quartz.event;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">import javax.annotation.PostConstruct;  </span><br><span class="line">  </span><br><span class="line">import org.slf4j.Logger;  </span><br><span class="line">import org.slf4j.LoggerFactory;  </span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;  </span><br><span class="line">import org.springframework.stereotype.Component;  </span><br><span class="line">  </span><br><span class="line">import com.jetsen.quartz.service.ScheduleJobService;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">&#x2F;** </span><br><span class="line"> * 定时任务初始化 </span><br><span class="line"> * @author sai </span><br><span class="line"> * @date 2016-07-25 </span><br><span class="line"> *&#x2F;  </span><br><span class="line">@Component  </span><br><span class="line">public class ScheduleJobInit &#123;  </span><br><span class="line">  </span><br><span class="line">    &#x2F;** 日志对象 *&#x2F;  </span><br><span class="line">    private static final Logger LOG &#x3D; LoggerFactory.getLogger(ScheduleJobInit.class);  </span><br><span class="line">  </span><br><span class="line">    &#x2F;** 定时任务service *&#x2F;  </span><br><span class="line">    @Autowired  </span><br><span class="line">    private ScheduleJobService  scheduleJobService;  </span><br><span class="line">  </span><br><span class="line">    &#x2F;** </span><br><span class="line">     * 项目启动时初始化 </span><br><span class="line">     *&#x2F;  </span><br><span class="line">    @PostConstruct  </span><br><span class="line">    public void init() &#123;  </span><br><span class="line">  </span><br><span class="line">        if (LOG.isInfoEnabled()) &#123;  </span><br><span class="line">            LOG.info(&quot;init&quot;);  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        scheduleJobService.initScheduleJob();  </span><br><span class="line">  </span><br><span class="line">        if (LOG.isInfoEnabled()) &#123;  </span><br><span class="line">            LOG.info(&quot;end&quot;);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>
<p>ScheduleException：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">package com.jetsen.quartz.exceptions;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">import com.dexcoder.commons.exceptions.DexcoderException;  </span><br><span class="line">  </span><br><span class="line">&#x2F;** </span><br><span class="line"> * 自定义异常 </span><br><span class="line"> * @author sai </span><br><span class="line"> * @date 2016-07-25 </span><br><span class="line"> *&#x2F;  </span><br><span class="line">public class ScheduleException extends DexcoderException &#123;  </span><br><span class="line">  </span><br><span class="line">    &#x2F;** serialVersionUID *&#x2F;  </span><br><span class="line">    private static final long serialVersionUID &#x3D; -1921648378954132894L;  </span><br><span class="line">  </span><br><span class="line">    &#x2F;** </span><br><span class="line">     * Instantiates a new ScheduleException. </span><br><span class="line">     * </span><br><span class="line">     * @param e the e </span><br><span class="line">     *&#x2F;  </span><br><span class="line">    public ScheduleException(Throwable e) &#123;  </span><br><span class="line">        super(e);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    &#x2F;** </span><br><span class="line">     * Constructor </span><br><span class="line">     * </span><br><span class="line">     * @param message the message </span><br><span class="line">     *&#x2F;  </span><br><span class="line">    public ScheduleException(String message) &#123;  </span><br><span class="line">        super(message);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    &#x2F;** </span><br><span class="line">     * Constructor </span><br><span class="line">     * </span><br><span class="line">     * @param code the code </span><br><span class="line">     * @param message the message </span><br><span class="line">     *&#x2F;  </span><br><span class="line">    public ScheduleException(String code, String message) &#123;  </span><br><span class="line">        super(code, message);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>
<p>JobFactory：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line">package com.jetsen.quartz.factory;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">import java.util.Date;  </span><br><span class="line">import java.util.List;  </span><br><span class="line">  </span><br><span class="line">import javax.servlet.http.HttpServletRequest;  </span><br><span class="line">  </span><br><span class="line">import org.quartz.DisallowConcurrentExecution;  </span><br><span class="line">import org.quartz.Job;  </span><br><span class="line">import org.quartz.JobDataMap;  </span><br><span class="line">import org.quartz.JobExecutionContext;  </span><br><span class="line">import org.quartz.JobExecutionException;  </span><br><span class="line">import org.slf4j.Logger;  </span><br><span class="line">import org.slf4j.LoggerFactory;  </span><br><span class="line">import org.springframework.stereotype.Service;  </span><br><span class="line">  </span><br><span class="line">import com.jetsen.common.bean.SpringBeanUtil;  </span><br><span class="line">import com.jetsen.common.util.StringUtil;  </span><br><span class="line">import com.jetsen.controller.LibraryController;  </span><br><span class="line">import com.jetsen.model.book.Book;  </span><br><span class="line">import com.jetsen.model.cms.Manuscript;  </span><br><span class="line">import com.jetsen.quartz.entity.ScheduleJob;  </span><br><span class="line">import com.jetsen.quartz.service.ScheduleJobService;  </span><br><span class="line">import com.jetsen.quartz.vo.ScheduleJobVo;  </span><br><span class="line">import com.jetsen.service.BookService;  </span><br><span class="line">import com.jetsen.service.ManuscriptService;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">&#x2F;** </span><br><span class="line"> * 任务工厂类,非同步 </span><br><span class="line"> * @author sai </span><br><span class="line"> * @date 2016-07-25 </span><br><span class="line"> *&#x2F;  </span><br><span class="line">@DisallowConcurrentExecution  </span><br><span class="line">public class JobFactory implements Job &#123;  </span><br><span class="line">  </span><br><span class="line">    &#x2F;* 日志对象 *&#x2F;  </span><br><span class="line">    private static final Logger LOG &#x3D; LoggerFactory.getLogger(JobFactory.class);  </span><br><span class="line">  </span><br><span class="line">    public void execute(JobExecutionContext context) throws JobExecutionException &#123;  </span><br><span class="line">  </span><br><span class="line">        LOG.info(&quot;JobFactory execute&quot;);  </span><br><span class="line">  </span><br><span class="line">        &#x2F;*ScheduleJob scheduleJob &#x3D; (ScheduleJob) context.getMergedJobDataMap().get( </span><br><span class="line">            ScheduleJobVo.JOB_PARAM_KEY);*&#x2F;  </span><br><span class="line">        ManuscriptService manuscriptService &#x3D; (ManuscriptService) SpringBeanUtil.getBean(&quot;jcManuscriptService&quot;);  </span><br><span class="line">        BookService companybookService &#x3D; (BookService) SpringBeanUtil.getBean(&quot;bookService&quot;);  </span><br><span class="line">        ScheduleJobService scheduleJobService &#x3D; (ScheduleJobService) SpringBeanUtil.getBean(&quot;scheduleJobService&quot;);  </span><br><span class="line">        JobDataMap dataMap &#x3D; context.getJobDetail().getJobDataMap();  </span><br><span class="line">        Long ids &#x3D; dataMap.getLong(&quot;jobParam&quot;);  </span><br><span class="line">        &#x2F;&#x2F;Manuscript content &#x3D; manuscriptService.getManuScriptByTask(ids);  </span><br><span class="line">        String library &#x3D; dataMap.getString(&quot;library&quot;);  </span><br><span class="line">        String issue &#x3D; dataMap.getString(&quot;issue&quot;);  </span><br><span class="line">        String books &#x3D; dataMap.getString(&quot;book&quot;);  </span><br><span class="line">        if(library!&#x3D;null)&#123;  </span><br><span class="line">            String publishStatus &#x3D; dataMap.getString(&quot;publishStatus&quot;);  </span><br><span class="line">            if(library.equals(&quot;library&quot;) ||  &quot;liarary&quot;.equals(library))&#123;  </span><br><span class="line">                List&lt;Book&gt; bookList &#x3D; companybookService.getBookList(1,publishStatus);  </span><br><span class="line">                if(bookList!&#x3D;null &amp;&amp; bookList.size()&gt;0)&#123;  </span><br><span class="line">                    String bookIds &#x3D; &quot;&quot;;  </span><br><span class="line">                    for (Book book : bookList) &#123;  </span><br><span class="line">                         bookIds +&#x3D; book.getBookid()+&quot;,&quot;;  </span><br><span class="line">                         &#x2F;&#x2F;companybookService.updateIsSend(2, bookIds);  </span><br><span class="line">                    &#125;  </span><br><span class="line">                    &#x2F;&#x2F;scheduleJobService.updateStatus(&quot;0&quot;);  </span><br><span class="line">                    companybookService.send(null, null, null, null, null,bookIds);  </span><br><span class="line">                &#125;  </span><br><span class="line">                  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">        if(issue!&#x3D;null)&#123;  </span><br><span class="line">            String publishStatus &#x3D; dataMap.getString(&quot;publishStatus&quot;);  </span><br><span class="line">            if(issue.equals(&quot;issue&quot;) ||  &quot;issue&quot;.equals(issue))&#123;  </span><br><span class="line">                List&lt;Book&gt; bookList &#x3D; companybookService.getBookList(1,publishStatus);  </span><br><span class="line">                if(bookList!&#x3D;null &amp;&amp; bookList.size()&gt;0)&#123;  </span><br><span class="line">                    String bookIds &#x3D; &quot;&quot;;  </span><br><span class="line">                    for (Book book : bookList) &#123;  </span><br><span class="line">                         bookIds +&#x3D; book.getBookid()+&quot;,&quot;;  </span><br><span class="line">                         &#x2F;&#x2F;companybookService.updateIsSend(2, bookIds);  </span><br><span class="line">                    &#125;  </span><br><span class="line">                    &#x2F;&#x2F;scheduleJobService.updateStatus(&quot;0&quot;);  </span><br><span class="line">                    companybookService.send(null, null, null, null, null,bookIds);  </span><br><span class="line">                &#125;  </span><br><span class="line">                  </span><br><span class="line">                  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">        if(books!&#x3D;null)&#123;  </span><br><span class="line">            String org_codes &#x3D; dataMap.getString(&quot;org_codes&quot;);  </span><br><span class="line">            String publishStatus &#x3D; dataMap.getString(&quot;publishStatus&quot;);  </span><br><span class="line">            String notificationType &#x3D; dataMap.getString(&quot;notificationType&quot;);  </span><br><span class="line">            if(books.equals(&quot;book&quot;) || &quot;book&quot;.equals(books))&#123;  </span><br><span class="line">                List&lt;Book&gt; bookList &#x3D; companybookService.getBookList(0,publishStatus);  </span><br><span class="line">                if(bookList!&#x3D;null &amp;&amp; bookList.size()&gt;0)&#123;  </span><br><span class="line">                    String bookIds &#x3D; &quot;&quot;;  </span><br><span class="line">                    for (Book book : bookList) &#123;  </span><br><span class="line">                         bookIds +&#x3D; book.getBookid()+&quot;,&quot;;  </span><br><span class="line">                        &#x2F;&#x2F; companybookService.updateIsSend(1, bookIds);  </span><br><span class="line">                    &#125;  </span><br><span class="line">                    companybookService.bookSend(notificationType,org_codes,bookIds);  </span><br><span class="line">                    &#x2F;&#x2F;scheduleJobService.updateStatus(&quot;0&quot;);  </span><br><span class="line">                &#125;  </span><br><span class="line">                  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">        if(ids!&#x3D;0L)&#123;  </span><br><span class="line">             manuscriptService.publishSingleState(1, new Date(), ids);  </span><br><span class="line">             scheduleJobService.updateInfoStatus(&quot;0&quot;, ids);  </span><br><span class="line">        &#125;  </span><br><span class="line">        try &#123;  </span><br><span class="line">            Thread.sleep(3000);  </span><br><span class="line">        &#125; catch (InterruptedException e) &#123;  </span><br><span class="line">            e.printStackTrace();  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>JobSyncFactory：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line">package com.jetsen.quartz.factory;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">import java.util.Date;  </span><br><span class="line">import java.util.List;  </span><br><span class="line">  </span><br><span class="line">import org.quartz.Job;  </span><br><span class="line">import org.quartz.JobDataMap;  </span><br><span class="line">import org.quartz.JobExecutionContext;  </span><br><span class="line">import org.quartz.JobExecutionException;  </span><br><span class="line">import org.slf4j.Logger;  </span><br><span class="line">import org.slf4j.LoggerFactory;  </span><br><span class="line">  </span><br><span class="line">import com.jetsen.common.bean.SpringBeanUtil;  </span><br><span class="line">import com.jetsen.model.book.Book;  </span><br><span class="line">import com.jetsen.quartz.service.ScheduleJobService;  </span><br><span class="line">import com.jetsen.service.BookService;  </span><br><span class="line">import com.jetsen.service.ManuscriptService;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">&#x2F;** </span><br><span class="line"> * 同步的任务工厂类 </span><br><span class="line"> * @author sai </span><br><span class="line"> * @date 2016-07-25 </span><br><span class="line"> *&#x2F;  </span><br><span class="line">public class JobSyncFactory implements Job &#123;  </span><br><span class="line">  </span><br><span class="line">    private static final Logger LOG &#x3D; LoggerFactory.getLogger(JobSyncFactory.class);  </span><br><span class="line">  </span><br><span class="line">    public void execute(JobExecutionContext context) throws JobExecutionException &#123;  </span><br><span class="line">  </span><br><span class="line">        LOG.info(&quot;JobSyncFactory execute&quot;);  </span><br><span class="line">  </span><br><span class="line">       &#x2F;* JobDataMap mergedJobDataMap &#x3D; jobExecutionContext.getMergedJobDataMap(); </span><br><span class="line">        ScheduleJob scheduleJob &#x3D; (ScheduleJob) mergedJobDataMap.get(ScheduleJobVo.JOB_PARAM_KEY); </span><br><span class="line"> </span><br><span class="line">        System.out.println(&quot;jobName:&quot; + scheduleJob.getJobName() + &quot;  &quot; + scheduleJob);*&#x2F;  </span><br><span class="line">          </span><br><span class="line">        ManuscriptService manuscriptService &#x3D; (ManuscriptService) SpringBeanUtil.getBean(&quot;jcManuscriptService&quot;);  </span><br><span class="line">        BookService companybookService &#x3D; (BookService) SpringBeanUtil.getBean(&quot;bookService&quot;);  </span><br><span class="line">        ScheduleJobService scheduleJobService &#x3D; (ScheduleJobService) SpringBeanUtil.getBean(&quot;scheduleJobService&quot;);  </span><br><span class="line">        JobDataMap dataMap &#x3D; context.getJobDetail().getJobDataMap();  </span><br><span class="line">        Long ids &#x3D; dataMap.getLong(&quot;jobParam&quot;);  </span><br><span class="line">        &#x2F;&#x2F;Manuscript content &#x3D; manuscriptService.getManuScriptByTask(ids);  </span><br><span class="line">        String library &#x3D; dataMap.getString(&quot;library&quot;);  </span><br><span class="line">        String issue &#x3D; dataMap.getString(&quot;issue&quot;);  </span><br><span class="line">        String books &#x3D; dataMap.getString(&quot;book&quot;);  </span><br><span class="line">        if(library!&#x3D;null)&#123;  </span><br><span class="line">            &#x2F;&#x2F;String publishStatus &#x3D; dataMap.getString(&quot;publishStatus&quot;);  </span><br><span class="line">            if(library.equals(&quot;library&quot;) ||  &quot;liarary&quot;.equals(library))&#123;  </span><br><span class="line">                List&lt;Book&gt; bookList &#x3D; companybookService.getBookList(1);  </span><br><span class="line">                if(bookList!&#x3D;null &amp;&amp; bookList.size()&gt;0)&#123;  </span><br><span class="line">                    String bookIds &#x3D; &quot;&quot;;  </span><br><span class="line">                    for (Book book : bookList) &#123;  </span><br><span class="line">                         bookIds +&#x3D; book.getBookid()+&quot;,&quot;;  </span><br><span class="line">                         &#x2F;&#x2F;companybookService.updateIsSend(2, bookIds);  </span><br><span class="line">                    &#125;  </span><br><span class="line">                    &#x2F;&#x2F;scheduleJobService.updateStatus(&quot;0&quot;);  </span><br><span class="line">                    companybookService.send(null, null, null, null, null,bookIds);  </span><br><span class="line">                &#125;  </span><br><span class="line">                  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">        if(issue!&#x3D;null)&#123;  </span><br><span class="line">            &#x2F;&#x2F;String publishStatus &#x3D; dataMap.getString(&quot;publishStatus&quot;);  </span><br><span class="line">            if(issue.equals(&quot;issue&quot;) ||  &quot;issue&quot;.equals(issue))&#123;  </span><br><span class="line">                List&lt;Book&gt; bookList &#x3D; companybookService.getBookList(1);  </span><br><span class="line">                if(bookList!&#x3D;null &amp;&amp; bookList.size()&gt;0)&#123;  </span><br><span class="line">                    String bookIds &#x3D; &quot;&quot;;  </span><br><span class="line">                    for (Book book : bookList) &#123;  </span><br><span class="line">                         bookIds +&#x3D; book.getBookid()+&quot;,&quot;;  </span><br><span class="line">                         &#x2F;&#x2F;companybookService.updateIsSend(2, bookIds);  </span><br><span class="line">                    &#125;  </span><br><span class="line">                    &#x2F;&#x2F;scheduleJobService.updateStatus(&quot;0&quot;);  </span><br><span class="line">                    companybookService.send(null, null, null, null, null,bookIds);  </span><br><span class="line">                &#125;  </span><br><span class="line">                  </span><br><span class="line">                  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">        if(books!&#x3D;null)&#123;  </span><br><span class="line">            String org_codes &#x3D; dataMap.getString(&quot;org_codes&quot;);  </span><br><span class="line">            String publishStatus &#x3D; dataMap.getString(&quot;publishStatus&quot;);  </span><br><span class="line">            String notificationType &#x3D; dataMap.getString(&quot;notificationType&quot;);  </span><br><span class="line">            if(books.equals(&quot;book&quot;) || &quot;book&quot;.equals(books))&#123;  </span><br><span class="line">                List&lt;Book&gt; bookList &#x3D; companybookService.getBookList(0,publishStatus);  </span><br><span class="line">                if(bookList!&#x3D;null &amp;&amp; bookList.size()&gt;0)&#123;  </span><br><span class="line">                    String bookIds &#x3D; &quot;&quot;;  </span><br><span class="line">                    for (Book book : bookList) &#123;  </span><br><span class="line">                         bookIds +&#x3D; book.getBookid()+&quot;,&quot;;  </span><br><span class="line">                        &#x2F;&#x2F; companybookService.updateIsSend(1, bookIds);  </span><br><span class="line">                    &#125;  </span><br><span class="line">                    companybookService.bookSend(notificationType,org_codes,bookIds);  </span><br><span class="line">                    &#x2F;&#x2F;scheduleJobService.updateStatus(&quot;0&quot;);  </span><br><span class="line">                &#125;  </span><br><span class="line">                  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">        if(ids!&#x3D;null &amp;&amp; ids!&#x3D;0)&#123;  </span><br><span class="line">             manuscriptService.publishSingleState(1, new Date(), ids);  </span><br><span class="line">             scheduleJobService.updateInfoStatus(&quot;0&quot;, ids);  </span><br><span class="line">        &#125;  </span><br><span class="line">        try &#123;  </span><br><span class="line">            Thread.sleep(3000);  </span><br><span class="line">        &#125; catch (InterruptedException e) &#123;  </span><br><span class="line">            e.printStackTrace();  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>
<p>说明：同步方法：比如说我定时了固定的时候，设置了好几个，都是在这个时间执行，那就要走同步方法才可以；非同步方法，是设置一个时间点，跟其他不冲突，这个没有问题，这里是要注意的地方，然后这俩方法可以加入自己想要执行的业务逻辑，这里只需知道怎么传递参数过来就行了，比如我判断了，或者传过来id啦，这里都可以的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">JobDataMap dataMap &#x3D; context.getJobDetail().getJobDataMap();  </span><br><span class="line">Long ids &#x3D; dataMap.getLong(&quot;jobParam&quot;);  </span><br><span class="line">String library &#x3D; dataMap.getString(&quot;library&quot;);</span><br></pre></td></tr></table></figure>
<p>这里可以接收不同的类型，比如我这里获取id用long来接收，而根据不同平台进行判断是string来接收参数。</p>
<p>ScheduleJobService：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line">package com.jetsen.quartz.service;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">import java.util.List;  </span><br><span class="line">  </span><br><span class="line">import com.jetsen.quartz.entity.ScheduleJob;  </span><br><span class="line">import com.jetsen.quartz.vo.ScheduleJobVo;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">&#x2F;** </span><br><span class="line"> * 定时任务service </span><br><span class="line"> * @author sai </span><br><span class="line"> * @date 2016-07-25 </span><br><span class="line"> *&#x2F;  </span><br><span class="line">public interface ScheduleJobService &#123;  </span><br><span class="line">  </span><br><span class="line">    &#x2F;** </span><br><span class="line">     * 初始化定时任务 </span><br><span class="line">     *&#x2F;  </span><br><span class="line">    public void initScheduleJob();  </span><br><span class="line">  </span><br><span class="line">    &#x2F;** </span><br><span class="line">     * 新增(这里参加增加是Mq的机构码) </span><br><span class="line">     * @param scheduleJobVo </span><br><span class="line">     * @return </span><br><span class="line">     *&#x2F;  </span><br><span class="line">    public void insert(ScheduleJobVo scheduleJobVo);  </span><br><span class="line">  </span><br><span class="line">    &#x2F;** </span><br><span class="line">     * 直接修改 只能修改运行的时间，参数、同异步等无法修改 </span><br><span class="line">     *  </span><br><span class="line">     * @param scheduleJobVo </span><br><span class="line">     *&#x2F;  </span><br><span class="line">    public void update(ScheduleJobVo scheduleJobVos);  </span><br><span class="line">  </span><br><span class="line">    &#x2F;** </span><br><span class="line">     * 删除重新创建方式 </span><br><span class="line">     *  </span><br><span class="line">     * @param scheduleJobVo </span><br><span class="line">     *&#x2F;  </span><br><span class="line">    public void delUpdate(ScheduleJobVo scheduleJobVo);  </span><br><span class="line">  </span><br><span class="line">    &#x2F;** </span><br><span class="line">     * 删除 </span><br><span class="line">     *  </span><br><span class="line">     * @param scheduleJobId </span><br><span class="line">     *&#x2F;  </span><br><span class="line">    public void delete(Long scheduleJobId);  </span><br><span class="line">  </span><br><span class="line">    &#x2F;** </span><br><span class="line">     * 运行一次任务 </span><br><span class="line">     * </span><br><span class="line">     * @param scheduleJobId the schedule job id </span><br><span class="line">     * @return </span><br><span class="line">     *&#x2F;  </span><br><span class="line">    public void runOnce(Long scheduleJobId);  </span><br><span class="line">  </span><br><span class="line">    &#x2F;** </span><br><span class="line">     * 暂停任务 </span><br><span class="line">     * </span><br><span class="line">     * @param scheduleJobId the schedule job id </span><br><span class="line">     * @return </span><br><span class="line">     *&#x2F;  </span><br><span class="line">    public void pauseJob(Long scheduleJobId);  </span><br><span class="line">  </span><br><span class="line">    &#x2F;** </span><br><span class="line">     * 恢复任务 </span><br><span class="line">     * </span><br><span class="line">     * @param scheduleJobId the schedule job id </span><br><span class="line">     * @return </span><br><span class="line">     *&#x2F;  </span><br><span class="line">    public void resumeJob(Long scheduleJobId);  </span><br><span class="line">  </span><br><span class="line">    &#x2F;** </span><br><span class="line">     * 获取任务对象 </span><br><span class="line">     *  </span><br><span class="line">     * @param scheduleJobId </span><br><span class="line">     * @return </span><br><span class="line">     *&#x2F;  </span><br><span class="line">    public ScheduleJobVo get(Long scheduleJobId);  </span><br><span class="line">  </span><br><span class="line">    &#x2F;** </span><br><span class="line">     * 查询任务列表 </span><br><span class="line">     *  </span><br><span class="line">     * @param scheduleJobVo </span><br><span class="line">     * @return </span><br><span class="line">     *&#x2F;  </span><br><span class="line">    public List&lt;ScheduleJobVo&gt; queryList(ScheduleJobVo scheduleJobVo);  </span><br><span class="line">  </span><br><span class="line">    &#x2F;** </span><br><span class="line">     * 获取运行中的任务列表 </span><br><span class="line">     * </span><br><span class="line">     * @return </span><br><span class="line">     *&#x2F;  </span><br><span class="line">    public List&lt;ScheduleJobVo&gt; queryExecutingJobList();  </span><br><span class="line">    &#x2F;** </span><br><span class="line">     * 修改状态 </span><br><span class="line">     * @param status </span><br><span class="line">     *&#x2F;  </span><br><span class="line">    public void updateStatus(String status,Long scheduleJobId);  </span><br><span class="line">    &#x2F;** </span><br><span class="line">     * 修改状态 </span><br><span class="line">     * @param status </span><br><span class="line">     *&#x2F;  </span><br><span class="line">    public void updateInfoStatus(String status,Long scheduleJobId);  </span><br><span class="line">      </span><br><span class="line">      </span><br><span class="line">    &#x2F;** </span><br><span class="line">     * 根据发送状态查重 </span><br><span class="line">     * @param sendStyle </span><br><span class="line">     * @return </span><br><span class="line">     *&#x2F;  </span><br><span class="line">    public List&lt;ScheduleJobVo&gt; findByStyle(String sendStyle);  </span><br><span class="line">      </span><br><span class="line">    &#x2F;** </span><br><span class="line">     * 根据id查询定时任务 </span><br><span class="line">     * @param id </span><br><span class="line">     * @return </span><br><span class="line">     *&#x2F;  </span><br><span class="line">    public List&lt;ScheduleJobVo&gt; findById(Long id);  </span><br><span class="line">    &#x2F;** </span><br><span class="line">     * 更新按钮参数 </span><br><span class="line">     * @param desc </span><br><span class="line">     * @param sid </span><br><span class="line">     *&#x2F;  </span><br><span class="line">    public void updateDesc(Long desc,Long sid);  </span><br><span class="line">    &#x2F;** </span><br><span class="line">     * 根据策略id删除定时任务 </span><br><span class="line">     * @param sid </span><br><span class="line">     *&#x2F;  </span><br><span class="line">    public void deleteBySid(Long sid);  </span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ScheduleJobServiceImpl：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br></pre></td><td class="code"><pre><span class="line">package com.jetsen.quartz.service.impl;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">import java.util.ArrayList;  </span><br><span class="line">import java.util.List;  </span><br><span class="line">  </span><br><span class="line">import org.quartz.CronTrigger;  </span><br><span class="line">import org.quartz.JobDetail;  </span><br><span class="line">import org.quartz.JobExecutionContext;  </span><br><span class="line">import org.quartz.JobKey;  </span><br><span class="line">import org.quartz.Scheduler;  </span><br><span class="line">import org.quartz.SchedulerException;  </span><br><span class="line">import org.quartz.Trigger;  </span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;  </span><br><span class="line">import org.springframework.stereotype.Service;  </span><br><span class="line">  </span><br><span class="line">import com.dexcoder.commons.bean.BeanConverter;  </span><br><span class="line">import com.jetsen.quartz.entity.ScheduleJob;  </span><br><span class="line">import com.jetsen.quartz.service.ScheduleJobService;  </span><br><span class="line">import com.jetsen.quartz.util.ScheduleUtils;  </span><br><span class="line">import com.jetsen.quartz.vo.ScheduleJobVo;  </span><br><span class="line">import com.jetsen.repository.SchedulejobRepository;  </span><br><span class="line">  </span><br><span class="line">&#x2F;** </span><br><span class="line"> * 定时任务 </span><br><span class="line"> * @author sai </span><br><span class="line"> * @date 2016-07-25 </span><br><span class="line"> *&#x2F;  </span><br><span class="line">@Service(&quot;scheduleJobService&quot;)  </span><br><span class="line">public class ScheduleJobServiceImpl implements ScheduleJobService &#123;  </span><br><span class="line">  </span><br><span class="line">    &#x2F;** 调度工厂Bean *&#x2F;  </span><br><span class="line">    @Autowired  </span><br><span class="line">    private Scheduler scheduler;  </span><br><span class="line">  </span><br><span class="line">    @Autowired  </span><br><span class="line">    private SchedulejobRepository   schedulejobRepository;  </span><br><span class="line">  </span><br><span class="line">    public void initScheduleJob() &#123;  </span><br><span class="line">        List&lt;ScheduleJob&gt; scheduleJobList &#x3D; schedulejobRepository.findAll();  </span><br><span class="line">        if (scheduleJobList&#x3D;&#x3D;null) &#123;  </span><br><span class="line">            return;  </span><br><span class="line">        &#125;  </span><br><span class="line">        for (ScheduleJob scheduleJob : scheduleJobList) &#123;  </span><br><span class="line">  </span><br><span class="line">            CronTrigger cronTrigger &#x3D; ScheduleUtils.getCronTrigger(scheduler, scheduleJob.getJobName(),  </span><br><span class="line">                scheduleJob.getJobGroup());  </span><br><span class="line">              </span><br><span class="line">              </span><br><span class="line">            if(scheduleJob.getStatus().equals(&quot;1&quot;))&#123;  </span><br><span class="line">                &#x2F;&#x2F;不存在，创建一个  </span><br><span class="line">                if (cronTrigger &#x3D;&#x3D; null) &#123;  </span><br><span class="line">                    ScheduleUtils.createScheduleJob(scheduler, scheduleJob);  </span><br><span class="line">                &#125; else &#123;  </span><br><span class="line">                    &#x2F;&#x2F;已存在，那么更新相应的定时设置  </span><br><span class="line">                    ScheduleUtils.updateScheduleJob(scheduler, scheduleJob);  </span><br><span class="line">                &#125;  </span><br><span class="line">            &#125;  </span><br><span class="line">              </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">    public void insert(ScheduleJobVo scheduleJobVo) &#123;  </span><br><span class="line">        ScheduleJob scheduleJob &#x3D; scheduleJobVo.getTargetObject(ScheduleJob.class);  </span><br><span class="line">        ScheduleUtils.createScheduleJob(scheduler, scheduleJob);  </span><br><span class="line">        if(scheduleJob.getSendStyle()!&#x3D;null)&#123;  </span><br><span class="line">            if(scheduleJobVo.getSendStyle().equals(&quot;job-library&quot;) || scheduleJobVo.getSendStyle().equals(&quot;job-library&quot;))&#123;  </span><br><span class="line">                schedulejobRepository.save(scheduleJob);  </span><br><span class="line">            &#125;  </span><br><span class="line">            if(scheduleJobVo.getSendStyle().equals(&quot;job-issue&quot;) || scheduleJobVo.getSendStyle().equals(&quot;job-issue&quot;))&#123;  </span><br><span class="line">                schedulejobRepository.save(scheduleJob);  </span><br><span class="line">            &#125;  </span><br><span class="line">            if(scheduleJobVo.getSendStyle().equals(&quot;job-book&quot;) || scheduleJobVo.getSendStyle().equals(&quot;job-book&quot;))&#123;  </span><br><span class="line">                schedulejobRepository.save(scheduleJob);  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">          </span><br><span class="line">    &#125;  </span><br><span class="line">    @Override  </span><br><span class="line">    public void update(ScheduleJobVo scheduleJobVo) &#123;  </span><br><span class="line">        ScheduleJob scheduleJob &#x3D; scheduleJobVo.getTargetObject(ScheduleJob.class);  </span><br><span class="line">        ScheduleUtils.updateScheduleJob(scheduler, scheduleJob);  </span><br><span class="line">        if(scheduleJob.getSendStyle()!&#x3D;null)&#123;  </span><br><span class="line">            if(scheduleJobVo.getSendStyle().equals(&quot;job-library&quot;) || scheduleJobVo.getSendStyle().equals(&quot;job-library&quot;))&#123;  </span><br><span class="line">                schedulejobRepository.save(scheduleJob);  </span><br><span class="line">            &#125;  </span><br><span class="line">            if(scheduleJobVo.getSendStyle().equals(&quot;job-issue&quot;) || scheduleJobVo.getSendStyle().equals(&quot;job-issue&quot;))&#123;  </span><br><span class="line">                schedulejobRepository.save(scheduleJob);  </span><br><span class="line">            &#125;  </span><br><span class="line">            if(scheduleJobVo.getSendStyle().equals(&quot;other&quot;) || scheduleJobVo.getSendStyle().equals(&quot;other&quot;))&#123;  </span><br><span class="line">                schedulejobRepository.save(scheduleJob);  </span><br><span class="line">            &#125;  </span><br><span class="line">            if(scheduleJobVo.getSendStyle().equals(&quot;job-book&quot;) || scheduleJobVo.getSendStyle().equals(&quot;job-book&quot;))&#123;  </span><br><span class="line">                schedulejobRepository.save(scheduleJob);  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public void delUpdate(ScheduleJobVo scheduleJobVo) &#123;  </span><br><span class="line">        ScheduleJob scheduleJob &#x3D; scheduleJobVo.getTargetObject(ScheduleJob.class);  </span><br><span class="line">        &#x2F;&#x2F;先删除  </span><br><span class="line">        ScheduleUtils.deleteScheduleJob(scheduler, scheduleJob.getJobName(), scheduleJob.getJobGroup());  </span><br><span class="line">        &#x2F;&#x2F;再创建  </span><br><span class="line">        ScheduleUtils.createScheduleJob(scheduler, scheduleJob);  </span><br><span class="line">        if(scheduleJob.getSendStyle()!&#x3D;null)&#123;  </span><br><span class="line">            if(scheduleJobVo.getSendStyle().equals(&quot;job-library&quot;) || scheduleJobVo.getSendStyle().equals(&quot;job-library&quot;))&#123;  </span><br><span class="line">                schedulejobRepository.save(scheduleJob);  </span><br><span class="line">            &#125;  </span><br><span class="line">            if(scheduleJobVo.getSendStyle().equals(&quot;job-issue&quot;) || scheduleJobVo.getSendStyle().equals(&quot;job-issue&quot;))&#123;  </span><br><span class="line">                schedulejobRepository.save(scheduleJob);  </span><br><span class="line">            &#125;  </span><br><span class="line">            if(scheduleJobVo.getSendStyle().equals(&quot;job-book&quot;) || scheduleJobVo.getSendStyle().equals(&quot;job-book&quot;))&#123;  </span><br><span class="line">                schedulejobRepository.save(scheduleJob);  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public void delete(Long scheduleJobId) &#123;  </span><br><span class="line">        ScheduleJob scheduleJob &#x3D; schedulejobRepository.findOne(scheduleJobId);  </span><br><span class="line">        &#x2F;&#x2F;删除运行的任务  </span><br><span class="line">        ScheduleUtils.deleteScheduleJob(scheduler, scheduleJob.getJobName(), scheduleJob.getJobGroup());  </span><br><span class="line">        &#x2F;&#x2F;删除数据  </span><br><span class="line">        &#x2F;&#x2F;schedulejobRepository.delete(scheduleJobId);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public void runOnce(Long scheduleJobId) &#123;  </span><br><span class="line">  </span><br><span class="line">        ScheduleJob scheduleJob &#x3D; schedulejobRepository.findOne(scheduleJobId);  </span><br><span class="line">        ScheduleUtils.runOnce(scheduler, scheduleJob.getJobName(), scheduleJob.getJobGroup());  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public void pauseJob(Long scheduleJobId) &#123;  </span><br><span class="line">  </span><br><span class="line">        ScheduleJob scheduleJob &#x3D; schedulejobRepository.findOne(scheduleJobId);  </span><br><span class="line">        ScheduleUtils.pauseJob(scheduler, scheduleJob.getJobName(), scheduleJob.getJobGroup());  </span><br><span class="line">  </span><br><span class="line">        &#x2F;&#x2F;演示数据库就不更新了  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public void resumeJob(Long scheduleJobId) &#123;  </span><br><span class="line">        ScheduleJob scheduleJob &#x3D; schedulejobRepository.findOne(scheduleJobId);  </span><br><span class="line">        ScheduleUtils.resumeJob(scheduler, scheduleJob.getJobName(), scheduleJob.getJobGroup());  </span><br><span class="line">  </span><br><span class="line">        &#x2F;&#x2F;演示数据库就不更新了  </span><br><span class="line">    &#125;  </span><br><span class="line">    &#x2F;&#x2F;这里是vo不知道为什么  </span><br><span class="line">    &#x2F;*public ScheduleJobVo get(Long scheduleJobId) &#123; </span><br><span class="line">        ScheduleJobVo scheduleJob &#x3D; schedulejobRepository.findOne(scheduleJobId); </span><br><span class="line">        return scheduleJob; </span><br><span class="line">    &#125;*&#x2F;  </span><br><span class="line">  </span><br><span class="line">    public List&lt;ScheduleJobVo&gt; queryList(ScheduleJobVo scheduleJobVo) &#123;  </span><br><span class="line">  </span><br><span class="line">        List&lt;ScheduleJob&gt; scheduleJobs &#x3D; schedulejobRepository.findAll();  </span><br><span class="line">  </span><br><span class="line">        List&lt;ScheduleJobVo&gt; scheduleJobVoList &#x3D; BeanConverter.convert(ScheduleJobVo.class, scheduleJobs);  </span><br><span class="line">        try &#123;  </span><br><span class="line">            for (ScheduleJobVo vo : scheduleJobVoList) &#123;  </span><br><span class="line">  </span><br><span class="line">                JobKey jobKey &#x3D; ScheduleUtils.getJobKey(vo.getJobName(), vo.getJobGroup());  </span><br><span class="line">                List&lt;? extends Trigger&gt; triggers &#x3D; scheduler.getTriggersOfJob(jobKey);  </span><br><span class="line">                if (triggers.size()&#x3D;&#x3D;0) &#123;  </span><br><span class="line">                    continue;  </span><br><span class="line">                &#125;  </span><br><span class="line">  </span><br><span class="line">                &#x2F;&#x2F;这里一个任务可以有多个触发器， 但是我们一个任务对应一个触发器，所以只取第一个即可，清晰明了  </span><br><span class="line">                Trigger trigger &#x3D; triggers.iterator().next();  </span><br><span class="line">                scheduleJobVo.setJobTrigger(trigger.getKey().getName());  </span><br><span class="line">  </span><br><span class="line">                Trigger.TriggerState triggerState &#x3D; scheduler.getTriggerState(trigger.getKey());  </span><br><span class="line">                vo.setStatus(triggerState.name());  </span><br><span class="line">  </span><br><span class="line">                if (trigger instanceof CronTrigger) &#123;  </span><br><span class="line">                    CronTrigger cronTrigger &#x3D; (CronTrigger) trigger;  </span><br><span class="line">                    String cronExpression &#x3D; cronTrigger.getCronExpression();  </span><br><span class="line">                    vo.setCronExpression(cronExpression);  </span><br><span class="line">                &#125;  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125; catch (SchedulerException e) &#123;  </span><br><span class="line">            &#x2F;&#x2F;演示用，就不处理了  </span><br><span class="line">        &#125;  </span><br><span class="line">        return scheduleJobVoList;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public List&lt;ScheduleJobVo&gt; queryExecutingJobList() &#123;  </span><br><span class="line">        try &#123;  </span><br><span class="line">            List&lt;JobExecutionContext&gt; executingJobs &#x3D; scheduler.getCurrentsaiExecutingJobs();  </span><br><span class="line">            List&lt;ScheduleJobVo&gt; jobList &#x3D; new ArrayList&lt;ScheduleJobVo&gt;(executingJobs.size());  </span><br><span class="line">            for (JobExecutionContext executingJob : executingJobs) &#123;  </span><br><span class="line">                ScheduleJobVo job &#x3D; new ScheduleJobVo();  </span><br><span class="line">                JobDetail jobDetail &#x3D; executingJob.getJobDetail();  </span><br><span class="line">                JobKey jobKey &#x3D; jobDetail.getKey();  </span><br><span class="line">                Trigger trigger &#x3D; executingJob.getTrigger();  </span><br><span class="line">                job.setJobName(jobKey.getName());  </span><br><span class="line">                job.setJobGroup(jobKey.getGroup());  </span><br><span class="line">                job.setJobTrigger(trigger.getKey().getName());  </span><br><span class="line">                Trigger.TriggerState triggerState &#x3D; scheduler.getTriggerState(trigger.getKey());  </span><br><span class="line">                job.setStatus(triggerState.name());  </span><br><span class="line">                if (trigger instanceof CronTrigger) &#123;  </span><br><span class="line">                    CronTrigger cronTrigger &#x3D; (CronTrigger) trigger;  </span><br><span class="line">                    String cronExpression &#x3D; cronTrigger.getCronExpression();  </span><br><span class="line">                    job.setCronExpression(cronExpression);  </span><br><span class="line">                &#125;  </span><br><span class="line">                jobList.add(job);  </span><br><span class="line">            &#125;  </span><br><span class="line">            return jobList;  </span><br><span class="line">        &#125; catch (SchedulerException e) &#123;  </span><br><span class="line">            &#x2F;&#x2F;演示用，就不处理了  </span><br><span class="line">            return null;  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">    &#125;  </span><br><span class="line">    @Override  </span><br><span class="line">    public ScheduleJobVo get(Long scheduleJobId) &#123;  </span><br><span class="line">        return schedulejobRepository.findById(scheduleJobId);  </span><br><span class="line">    &#125;  </span><br><span class="line">    @Override  </span><br><span class="line">    public void updateStatus(String status,Long scheduleJobId) &#123;  </span><br><span class="line">        schedulejobRepository.updateStatus(status,scheduleJobId);  </span><br><span class="line">          </span><br><span class="line">    &#125;  </span><br><span class="line">    @Override  </span><br><span class="line">    public List&lt;ScheduleJobVo&gt; findByStyle(String sendStyle) &#123;  </span><br><span class="line">        return schedulejobRepository.findByStyle(sendStyle);  </span><br><span class="line">    &#125;  </span><br><span class="line">    @Override  </span><br><span class="line">    public void updateDesc(Long desc, Long sid) &#123;  </span><br><span class="line">        schedulejobRepository.updateStatus(desc, sid);  </span><br><span class="line">          </span><br><span class="line">    &#125;  </span><br><span class="line">    @Override  </span><br><span class="line">    public List&lt;ScheduleJobVo&gt; findById(Long id) &#123;  </span><br><span class="line">        return schedulejobRepository.findBySId(id);  </span><br><span class="line">    &#125;  </span><br><span class="line">    @Override  </span><br><span class="line">    public void deleteBySid(Long sid) &#123;  </span><br><span class="line">        schedulejobRepository.delete_strategy(sid);  </span><br><span class="line">          </span><br><span class="line">    &#125;  </span><br><span class="line">    @Override  </span><br><span class="line">    public void updateInfoStatus(String status, Long scheduleJobId) &#123;  </span><br><span class="line">        schedulejobRepository.updateInfoStatus(status, scheduleJobId);  </span><br><span class="line">          </span><br><span class="line">    &#125;  </span><br><span class="line">      </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">&#125;  </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ScheduleUtils：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br></pre></td><td class="code"><pre><span class="line">package com.jetsen.quartz.util;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">import org.quartz.CronScheduleBuilder;  </span><br><span class="line">import org.quartz.CronTrigger;  </span><br><span class="line">import org.quartz.Job;  </span><br><span class="line">import org.quartz.JobBuilder;  </span><br><span class="line">import org.quartz.JobDetail;  </span><br><span class="line">import org.quartz.JobKey;  </span><br><span class="line">import org.quartz.Scheduler;  </span><br><span class="line">import org.quartz.SchedulerException;  </span><br><span class="line">import org.quartz.TriggerBuilder;  </span><br><span class="line">import org.quartz.TriggerKey;  </span><br><span class="line">import org.slf4j.Logger;  </span><br><span class="line">import org.slf4j.LoggerFactory;  </span><br><span class="line">  </span><br><span class="line">import com.jetsen.quartz.entity.ScheduleJob;  </span><br><span class="line">import com.jetsen.quartz.exceptions.ScheduleException;  </span><br><span class="line">import com.jetsen.quartz.factory.JobFactory;  </span><br><span class="line">import com.jetsen.quartz.factory.JobSyncFactory;  </span><br><span class="line">import com.jetsen.quartz.vo.ScheduleJobVo;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">&#x2F;** </span><br><span class="line"> * 定时任务辅助类 </span><br><span class="line"> * @author sai </span><br><span class="line"> * @date 2016-07-25 </span><br><span class="line"> *&#x2F;  </span><br><span class="line">public class ScheduleUtils &#123;  </span><br><span class="line">  </span><br><span class="line">    &#x2F;** 日志对象 *&#x2F;  </span><br><span class="line">    private static final Logger LOG &#x3D; LoggerFactory.getLogger(ScheduleUtils.class);  </span><br><span class="line">  </span><br><span class="line">    &#x2F;** </span><br><span class="line">     * 获取触发器key </span><br><span class="line">     *  </span><br><span class="line">     * @param jobName </span><br><span class="line">     * @param jobGroup </span><br><span class="line">     * @return </span><br><span class="line">     *&#x2F;  </span><br><span class="line">    public static TriggerKey getTriggerKey(String jobName, String jobGroup) &#123;  </span><br><span class="line">  </span><br><span class="line">        return TriggerKey.triggerKey(jobName, jobGroup);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    &#x2F;** </span><br><span class="line">     * 获取表达式触发器 </span><br><span class="line">     * </span><br><span class="line">     * @param scheduler the scheduler </span><br><span class="line">     * @param jobName the job name </span><br><span class="line">     * @param jobGroup the job group </span><br><span class="line">     * @return cron trigger </span><br><span class="line">     *&#x2F;  </span><br><span class="line">    public static CronTrigger getCronTrigger(Scheduler scheduler, String jobName, String jobGroup) &#123;  </span><br><span class="line">  </span><br><span class="line">        try &#123;  </span><br><span class="line">            TriggerKey triggerKey &#x3D; TriggerKey.triggerKey(jobName, jobGroup);  </span><br><span class="line">            return (CronTrigger) scheduler.getTrigger(triggerKey);  </span><br><span class="line">        &#125; catch (SchedulerException e) &#123;  </span><br><span class="line">            LOG.info(&quot;获取定时任务CronTrigger出现异常&quot;, e);  </span><br><span class="line">            throw new ScheduleException(&quot;获取定时任务CronTrigger出现异常&quot;);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    &#x2F;** </span><br><span class="line">     * 创建任务 </span><br><span class="line">     * </span><br><span class="line">     * @param scheduler the scheduler </span><br><span class="line">     * @param scheduleJob the schedule job </span><br><span class="line">     *&#x2F;  </span><br><span class="line">    public static void createScheduleJob(Scheduler scheduler, ScheduleJob scheduleJob) &#123;  </span><br><span class="line">        createScheduleJob(scheduler, scheduleJob.getJobName(), scheduleJob.getJobGroup(),  </span><br><span class="line">            scheduleJob.getCronExpression(), scheduleJob.getIsSync(), scheduleJob.getDescription(),scheduleJob.getStatus(),scheduleJob.getSendStyle(),scheduleJob.getOrg_codes(),scheduleJob.getPublishState(),scheduleJob.getNotificationType());  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    &#x2F;** </span><br><span class="line">     * 创建定时任务 </span><br><span class="line">     * </span><br><span class="line">     * @param scheduler the scheduler </span><br><span class="line">     * @param jobName the job name </span><br><span class="line">     * @param jobGroup the job group </span><br><span class="line">     * @param cronExpression the cron expression </span><br><span class="line">     * @param isSync the is sync </span><br><span class="line">     * @param param the param </span><br><span class="line">     *&#x2F;  </span><br><span class="line">    public static void createScheduleJob(Scheduler scheduler, String jobName, String jobGroup,  </span><br><span class="line">                                         String cronExpression, boolean isSync, Long param,String status,String sendStyle,String org_codes,String publishStatus,String notificationType) &#123;  </span><br><span class="line">        &#x2F;&#x2F;同步或异步  </span><br><span class="line">        Class&lt;? extends Job&gt; jobClass &#x3D; isSync ? JobSyncFactory.class : JobFactory.class;  </span><br><span class="line">        &#x2F;&#x2F;构建job信息  </span><br><span class="line">        JobDetail jobDetail &#x3D; JobBuilder.newJob(jobClass).withIdentity(jobName, jobGroup).build();  </span><br><span class="line">        if(param!&#x3D;null)&#123;  </span><br><span class="line">            &#x2F;&#x2F;放入参数，运行时的方法可以获取  </span><br><span class="line">            jobDetail.getJobDataMap().put(ScheduleJobVo.JOB_PARAM_KEY, param);  </span><br><span class="line">        &#125;else&#123;  </span><br><span class="line">             Long paramValue &#x3D; 0L;  </span><br><span class="line">             jobDetail.getJobDataMap().put(ScheduleJobVo.JOB_PARAM_KEY, paramValue);  </span><br><span class="line">        &#125;  </span><br><span class="line">          </span><br><span class="line">        if(sendStyle!&#x3D;null)&#123;  </span><br><span class="line">             if(sendStyle.equals(&quot;job-library&quot;) || &quot;job-library&quot;.equals(sendStyle))&#123;  </span><br><span class="line">                jobDetail.getJobDataMap().put(&quot;library&quot;, &quot;library&quot;);  </span><br><span class="line">             &#125;  </span><br><span class="line">             if(sendStyle.equals(&quot;job-issue&quot;) || &quot;job-issue&quot;.equals(sendStyle))&#123;  </span><br><span class="line">                jobDetail.getJobDataMap().put(&quot;issue&quot;, &quot;issue&quot;);  </span><br><span class="line">             &#125;  </span><br><span class="line">             if(sendStyle.equals(&quot;job-book&quot;) || &quot;job-book&quot;.equals(sendStyle))&#123;  </span><br><span class="line">                jobDetail.getJobDataMap().put(&quot;book&quot;, &quot;book&quot;);  </span><br><span class="line">             &#125;  </span><br><span class="line">        &#125;  </span><br><span class="line">        if(org_codes!&#x3D;null)&#123;  </span><br><span class="line">            jobDetail.getJobDataMap().put(&quot;org_codes&quot;, org_codes);  </span><br><span class="line">        &#125;  </span><br><span class="line">        if(publishStatus!&#x3D;null)&#123;  </span><br><span class="line">            jobDetail.getJobDataMap().put(&quot;publishStatus&quot;, publishStatus);  </span><br><span class="line">        &#125;  </span><br><span class="line">        if(notificationType!&#x3D;null)&#123;  </span><br><span class="line">            jobDetail.getJobDataMap().put(&quot;notificationType&quot;, notificationType);  </span><br><span class="line">        &#125;  </span><br><span class="line">        &#x2F;&#x2F;表达式调度构建器  </span><br><span class="line">        CronScheduleBuilder scheduleBuilder &#x3D; CronScheduleBuilder.cronSchedule(cronExpression);  </span><br><span class="line">  </span><br><span class="line">        &#x2F;&#x2F;按新的cronExpression表达式构建一个新的trigger  </span><br><span class="line">        CronTrigger trigger &#x3D; TriggerBuilder.newTrigger().withIdentity(jobName, jobGroup)  </span><br><span class="line">            .withSchedule(scheduleBuilder).build();  </span><br><span class="line">  </span><br><span class="line">        try &#123;  </span><br><span class="line">            if(status.equals(&quot;1&quot;))&#123;  </span><br><span class="line">                scheduler.scheduleJob(jobDetail, trigger);  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125; catch (SchedulerException e) &#123;  </span><br><span class="line">            LOG.info(&quot;创建定时任务失败&quot;, e);  </span><br><span class="line">            throw new ScheduleException(&quot;创建定时任务失败&quot;);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    &#x2F;** </span><br><span class="line">     * 运行一次任务 </span><br><span class="line">     *  </span><br><span class="line">     * @param scheduler </span><br><span class="line">     * @param jobName </span><br><span class="line">     * @param jobGroup </span><br><span class="line">     *&#x2F;  </span><br><span class="line">    public static void runOnce(Scheduler scheduler, String jobName, String jobGroup) &#123;  </span><br><span class="line">        JobKey jobKey &#x3D; JobKey.jobKey(jobName, jobGroup);  </span><br><span class="line">        try &#123;  </span><br><span class="line">            scheduler.triggerJob(jobKey);  </span><br><span class="line">        &#125; catch (SchedulerException e) &#123;  </span><br><span class="line">            LOG.info(&quot;运行一次定时任务失败&quot;, e);  </span><br><span class="line">            throw new ScheduleException(&quot;运行一次定时任务失败&quot;);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    &#x2F;** </span><br><span class="line">     * 暂停任务 </span><br><span class="line">     *  </span><br><span class="line">     * @param scheduler </span><br><span class="line">     * @param jobName </span><br><span class="line">     * @param jobGroup </span><br><span class="line">     *&#x2F;  </span><br><span class="line">    public static void pauseJob(Scheduler scheduler, String jobName, String jobGroup) &#123;  </span><br><span class="line">  </span><br><span class="line">        JobKey jobKey &#x3D; JobKey.jobKey(jobName, jobGroup);  </span><br><span class="line">        try &#123;  </span><br><span class="line">            scheduler.pauseJob(jobKey);  </span><br><span class="line">        &#125; catch (SchedulerException e) &#123;  </span><br><span class="line">            LOG.info(&quot;暂停定时任务失败&quot;, e);  </span><br><span class="line">            throw new ScheduleException(&quot;暂停定时任务失败&quot;);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    &#x2F;** </span><br><span class="line">     * 恢复任务 </span><br><span class="line">     * </span><br><span class="line">     * @param scheduler </span><br><span class="line">     * @param jobName </span><br><span class="line">     * @param jobGroup </span><br><span class="line">     *&#x2F;  </span><br><span class="line">    public static void resumeJob(Scheduler scheduler, String jobName, String jobGroup) &#123;  </span><br><span class="line">  </span><br><span class="line">        JobKey jobKey &#x3D; JobKey.jobKey(jobName, jobGroup);  </span><br><span class="line">        try &#123;  </span><br><span class="line">            scheduler.resumeJob(jobKey);  </span><br><span class="line">        &#125; catch (SchedulerException e) &#123;  </span><br><span class="line">            LOG.info(&quot;暂停定时任务失败&quot;, e);  </span><br><span class="line">            throw new ScheduleException(&quot;暂停定时任务失败&quot;);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    &#x2F;** </span><br><span class="line">     * 获取jobKey </span><br><span class="line">     * </span><br><span class="line">     * @param jobName the job name </span><br><span class="line">     * @param jobGroup the job group </span><br><span class="line">     * @return the job key </span><br><span class="line">     *&#x2F;  </span><br><span class="line">    public static JobKey getJobKey(String jobName, String jobGroup) &#123;  </span><br><span class="line">  </span><br><span class="line">        return JobKey.jobKey(jobName, jobGroup);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    &#x2F;** </span><br><span class="line">     * 更新定时任务 </span><br><span class="line">     * </span><br><span class="line">     * @param scheduler the scheduler </span><br><span class="line">     * @param scheduleJob the schedule job </span><br><span class="line">     *&#x2F;  </span><br><span class="line">    public static void updateScheduleJob(Scheduler scheduler, ScheduleJob scheduleJob) &#123;  </span><br><span class="line">        updateScheduleJob(scheduler, scheduleJob.getJobName(), scheduleJob.getJobGroup(),  </span><br><span class="line">            scheduleJob.getCronExpression(), scheduleJob.getIsSync(), scheduleJob);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    &#x2F;** </span><br><span class="line">     * 更新定时任务 </span><br><span class="line">     * </span><br><span class="line">     * @param scheduler the scheduler </span><br><span class="line">     * @param jobName the job name </span><br><span class="line">     * @param jobGroup the job group </span><br><span class="line">     * @param cronExpression the cron expression </span><br><span class="line">     * @param isSync the is sync </span><br><span class="line">     * @param param the param </span><br><span class="line">     *&#x2F;  </span><br><span class="line">    public static void updateScheduleJob(Scheduler scheduler, String jobName, String jobGroup,  </span><br><span class="line">                                         String cronExpression, boolean isSync, Object param) &#123;  </span><br><span class="line">  </span><br><span class="line">        &#x2F;&#x2F;同步或异步  </span><br><span class="line">&#x2F;&#x2F;        Class&lt;? extends Job&gt; jobClass &#x3D; isSync ? JobSyncFactory.class : JobFactory.class;  </span><br><span class="line">  </span><br><span class="line">        try &#123;  </span><br><span class="line">&#x2F;&#x2F;            JobDetail jobDetail &#x3D; scheduler.getJobDetail(getJobKey(jobName, jobGroup));  </span><br><span class="line">  </span><br><span class="line">&#x2F;&#x2F;            jobDetail &#x3D; jobDetail.getJobBuilder().ofType(jobClass).build();  </span><br><span class="line">  </span><br><span class="line">            &#x2F;&#x2F;更新参数 实际测试中发现无法更新  </span><br><span class="line">&#x2F;&#x2F;            JobDataMap jobDataMap &#x3D; jobDetail.getJobDataMap();  </span><br><span class="line">&#x2F;&#x2F;            jobDataMap.put(ScheduleJobVo.JOB_PARAM_KEY, param);  </span><br><span class="line">&#x2F;&#x2F;            jobDetail.getJobBuilder().usingJobData(jobDataMap);  </span><br><span class="line">  </span><br><span class="line">            TriggerKey triggerKey &#x3D; ScheduleUtils.getTriggerKey(jobName, jobGroup);  </span><br><span class="line">  </span><br><span class="line">            &#x2F;&#x2F;表达式调度构建器  </span><br><span class="line">            CronScheduleBuilder scheduleBuilder &#x3D; CronScheduleBuilder.cronSchedule(cronExpression);  </span><br><span class="line">  </span><br><span class="line">            CronTrigger trigger &#x3D; (CronTrigger) scheduler.getTrigger(triggerKey);  </span><br><span class="line">  </span><br><span class="line">            &#x2F;&#x2F;按新的cronExpression表达式重新构建trigger  </span><br><span class="line">            trigger &#x3D; trigger.getTriggerBuilder().withIdentity(triggerKey).withSchedule(scheduleBuilder)  </span><br><span class="line">                .build();  </span><br><span class="line">  </span><br><span class="line">            &#x2F;&#x2F;按新的trigger重新设置job执行  </span><br><span class="line">            scheduler.rescheduleJob(triggerKey, trigger);  </span><br><span class="line">        &#125; catch (SchedulerException e) &#123;  </span><br><span class="line">            LOG.info(&quot;更新定时任务失败&quot;, e);  </span><br><span class="line">            throw new ScheduleException(&quot;更新定时任务失败&quot;);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    &#x2F;** </span><br><span class="line">     * 删除定时任务 </span><br><span class="line">     * </span><br><span class="line">     * @param scheduler </span><br><span class="line">     * @param jobName </span><br><span class="line">     * @param jobGroup </span><br><span class="line">     *&#x2F;  </span><br><span class="line">    public static void deleteScheduleJob(Scheduler scheduler, String jobName, String jobGroup) &#123;  </span><br><span class="line">        try &#123;  </span><br><span class="line">            scheduler.deleteJob(getJobKey(jobName, jobGroup));  </span><br><span class="line">        &#125; catch (SchedulerException e) &#123;  </span><br><span class="line">            LOG.info(&quot;删除定时任务失败&quot;, e);  </span><br><span class="line">            throw new ScheduleException(&quot;删除定时任务失败&quot;);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>
<p>说明：看，这里的**jobDetail.getJobDataMap().put(“library”, “library”);**就是将你想传递的参数进行put压值</p>
<p>ScheduleJobVo：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br></pre></td><td class="code"><pre><span class="line">package com.jetsen.quartz.vo;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">import java.util.Date;  </span><br><span class="line">  </span><br><span class="line">import javax.persistence.CascadeType;  </span><br><span class="line">import javax.persistence.Column;  </span><br><span class="line">import javax.persistence.Entity;  </span><br><span class="line">import javax.persistence.GeneratedValue;  </span><br><span class="line">import javax.persistence.GenerationType;  </span><br><span class="line">import javax.persistence.Id;  </span><br><span class="line">import javax.persistence.JoinColumn;  </span><br><span class="line">import javax.persistence.ManyToOne;  </span><br><span class="line">import javax.persistence.Table;  </span><br><span class="line">  </span><br><span class="line">import org.hibernate.annotations.Cache;  </span><br><span class="line">import org.hibernate.annotations.CacheConcurrencyStrategy;  </span><br><span class="line">  </span><br><span class="line">import com.dexcoder.commons.pager.Pageable;  </span><br><span class="line">import com.jetsen.model.book.Strategy;  </span><br><span class="line">  </span><br><span class="line">&#x2F;** </span><br><span class="line"> * @author sai </span><br><span class="line"> * @date 2016-07-25 </span><br><span class="line"> *&#x2F;  </span><br><span class="line">@Entity  </span><br><span class="line">@Table(name &#x3D; &quot;task_scheduleJob&quot;)  </span><br><span class="line">public class ScheduleJobVo extends Pageable &#123;  </span><br><span class="line">  </span><br><span class="line">    private static final long  serialVersionUID &#x3D; -4216107640768329946L;  </span><br><span class="line">  </span><br><span class="line">    &#x2F;** 任务调度的参数key *&#x2F;  </span><br><span class="line">    public static final String JOB_PARAM_KEY    &#x3D; &quot;jobParam&quot;;  </span><br><span class="line">  </span><br><span class="line">    &#x2F;** 任务id *&#x2F;  </span><br><span class="line">    private Long               scheduleJobId;  </span><br><span class="line">  </span><br><span class="line">    &#x2F;** 任务名称 *&#x2F;  </span><br><span class="line">    private String             jobName;  </span><br><span class="line">  </span><br><span class="line">    &#x2F;** 任务别名 *&#x2F;  </span><br><span class="line">    private String             aliasName;  </span><br><span class="line">  </span><br><span class="line">    &#x2F;** 任务分组 *&#x2F;  </span><br><span class="line">    private String             jobGroup;  </span><br><span class="line">  </span><br><span class="line">    &#x2F;** 触发器 *&#x2F;  </span><br><span class="line">    private String             jobTrigger;  </span><br><span class="line">  </span><br><span class="line">    &#x2F;** 任务状态 *&#x2F;  </span><br><span class="line">    private String             status;  </span><br><span class="line">  </span><br><span class="line">    &#x2F;** 任务运行时间表达式 *&#x2F;  </span><br><span class="line">    private String             cronExpression;  </span><br><span class="line">  </span><br><span class="line">    &#x2F;** 是否异步 *&#x2F;  </span><br><span class="line">    private boolean            isSync;  </span><br><span class="line">  </span><br><span class="line">    &#x2F;** 任务描述 *&#x2F;  </span><br><span class="line">    private Long             description;  </span><br><span class="line">  </span><br><span class="line">    &#x2F;** 创建时间 *&#x2F;  </span><br><span class="line">    private Date               gmtCreate;  </span><br><span class="line">  </span><br><span class="line">    &#x2F;** 修改时间 *&#x2F;  </span><br><span class="line">    private Date               gmtModify;  </span><br><span class="line">    &#x2F;&#x2F;发送方式  </span><br><span class="line">    private String  sendStyle;  </span><br><span class="line">    &#x2F;&#x2F;这里方便展示   </span><br><span class="line">    private String  taskTime;  </span><br><span class="line">    private String descInfo;  </span><br><span class="line">    &#x2F;** 定时的机构编码封装在表中方便传递*&#x2F;  </span><br><span class="line">    private String org_codes;  </span><br><span class="line">    private String org_names;  </span><br><span class="line">    private String publishState;&#x2F;&#x2F;出版状态  </span><br><span class="line">    private String notificationType;  </span><br><span class="line">    private Strategy strategy;  </span><br><span class="line">    @Id  </span><br><span class="line">    @GeneratedValue(strategy&#x3D;GenerationType.IDENTITY)  </span><br><span class="line">    @Column(name &#x3D; &quot;scheduleJobId&quot;, nullable &#x3D; false)  </span><br><span class="line">    public Long getScheduleJobId() &#123;  </span><br><span class="line">        return scheduleJobId;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public void setScheduleJobId(Long scheduleJobId) &#123;  </span><br><span class="line">        this.scheduleJobId &#x3D; scheduleJobId;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public String getJobName() &#123;  </span><br><span class="line">        return jobName;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public void setJobName(String jobName) &#123;  </span><br><span class="line">        this.jobName &#x3D; jobName;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public String getAliasName() &#123;  </span><br><span class="line">        return aliasName;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public void setAliasName(String aliasName) &#123;  </span><br><span class="line">        this.aliasName &#x3D; aliasName;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public String getJobGroup() &#123;  </span><br><span class="line">        return jobGroup;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public void setJobGroup(String jobGroup) &#123;  </span><br><span class="line">        this.jobGroup &#x3D; jobGroup;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public String getJobTrigger() &#123;  </span><br><span class="line">        return jobTrigger;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public void setJobTrigger(String jobTrigger) &#123;  </span><br><span class="line">        this.jobTrigger &#x3D; jobTrigger;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public String getStatus() &#123;  </span><br><span class="line">        return status;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public void setStatus(String status) &#123;  </span><br><span class="line">        this.status &#x3D; status;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public String getCronExpression() &#123;  </span><br><span class="line">        return cronExpression;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public void setCronExpression(String cronExpression) &#123;  </span><br><span class="line">        this.cronExpression &#x3D; cronExpression;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">      </span><br><span class="line">    public Long getDescription() &#123;  </span><br><span class="line">        return description;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public void setDescription(Long description) &#123;  </span><br><span class="line">        this.description &#x3D; description;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public void setSync(boolean isSync) &#123;  </span><br><span class="line">        this.isSync &#x3D; isSync;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public Date getGmtCreate() &#123;  </span><br><span class="line">        return gmtCreate;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public void setGmtCreate(Date gmtCreate) &#123;  </span><br><span class="line">        this.gmtCreate &#x3D; gmtCreate;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public Date getGmtModify() &#123;  </span><br><span class="line">        return gmtModify;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public void setGmtModify(Date gmtModify) &#123;  </span><br><span class="line">        this.gmtModify &#x3D; gmtModify;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public Boolean getIsSync() &#123;  </span><br><span class="line">        return isSync;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public void setIsSync(Boolean isSync) &#123;  </span><br><span class="line">        this.isSync &#x3D; isSync;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public String getTaskTime() &#123;  </span><br><span class="line">        return taskTime;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public void setTaskTime(String taskTime) &#123;  </span><br><span class="line">        this.taskTime &#x3D; taskTime;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public String getSendStyle() &#123;  </span><br><span class="line">        return sendStyle;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public void setSendStyle(String sendStyle) &#123;  </span><br><span class="line">        this.sendStyle &#x3D; sendStyle;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public String getDescInfo() &#123;  </span><br><span class="line">        return descInfo;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public void setDescInfo(String descInfo) &#123;  </span><br><span class="line">        this.descInfo &#x3D; descInfo;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public String getOrg_codes() &#123;  </span><br><span class="line">        return org_codes;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public void setOrg_codes(String org_codes) &#123;  </span><br><span class="line">        this.org_codes &#x3D; org_codes;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public String getPublishState() &#123;  </span><br><span class="line">        return publishState;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public void setPublishState(String publishState) &#123;  </span><br><span class="line">        this.publishState &#x3D; publishState;  </span><br><span class="line">    &#125;  </span><br><span class="line">    @ManyToOne(cascade &#x3D; &#123;CascadeType.MERGE,CascadeType.REFRESH &#125;, optional &#x3D; true)   </span><br><span class="line">    @JoinColumn(name&#x3D;&quot;stratesaiId&quot;)  </span><br><span class="line">    @Cache(usage &#x3D; CacheConcurrencyStrategy.READ_WRITE)  </span><br><span class="line">    public Strategy getStrategy() &#123;  </span><br><span class="line">        return strategy;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public void setStrategy(Strategy strategy) &#123;  </span><br><span class="line">        this.strategy &#x3D; strategy;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public String getNotificationType() &#123;  </span><br><span class="line">        return notificationType;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public void setNotificationType(String notificationType) &#123;  </span><br><span class="line">        this.notificationType &#x3D; notificationType;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public String getOrg_names() &#123;  </span><br><span class="line">        return org_names;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    public void setOrg_names(String org_names) &#123;  </span><br><span class="line">        this.org_names &#x3D; org_names;  </span><br><span class="line">    &#125;  </span><br><span class="line">      </span><br><span class="line">      </span><br><span class="line">      </span><br><span class="line">      </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<p>StrategyController（实现的controller）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br></pre></td><td class="code"><pre><span class="line">@RequestMapping(&quot;&#x2F;saveScheduleSend&quot;)  </span><br><span class="line">    public String saveScheduleSend(String times,String org_codes,String strategyName,String org_name,RedirectAttributes redirectAttributes,String[] englishName,  </span><br><span class="line">            String publish_status,String notification_type,String taskSwitch,Long sid,String type,String style) throws Exception&#123;  </span><br><span class="line">        String task &#x3D; &quot;&quot;;  </span><br><span class="line">        &#x2F;*if(times.indexOf(&quot;,&quot;)&gt;0)&#123; </span><br><span class="line">            task &#x3D; times.substring(0,times.length() - 1); </span><br><span class="line">        &#125;else&#123; </span><br><span class="line">            task &#x3D; times; </span><br><span class="line">        &#125;*&#x2F;  </span><br><span class="line">        &#x2F;*if(org_name.indexOf(&quot;,&quot;)&gt;0)&#123; </span><br><span class="line">            org_name &#x3D; org_name.substring(1, org_name.length()); </span><br><span class="line">        &#125;*&#x2F;  </span><br><span class="line">        if(style.equals(&quot;edit&quot;) &amp;&amp; &quot;edit&quot;.equals(style))&#123;  </span><br><span class="line">            if (times.lastIndexOf(&quot;,&quot;)&gt;0) &#123;  </span><br><span class="line">                task &#x3D; times.substring(0,times.length() - 1);  </span><br><span class="line">            &#125;else if(times.startsWith(&quot;,&quot;))&#123;  </span><br><span class="line">                task &#x3D; times.substring(1, times.length());  </span><br><span class="line">            &#125;else&#123;  </span><br><span class="line">                task &#x3D; times;  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;else&#123;  </span><br><span class="line">            task &#x3D; times.substring(0,times.length() - 1);  </span><br><span class="line">        &#125;  </span><br><span class="line">        &#x2F;&#x2F;SimpleDateFormat sdf &#x3D; new SimpleDateFormat(&quot;HH:mm&quot;);  </span><br><span class="line">        List&lt;ScheduleJobVo&gt; jobList &#x3D; scheduleJobService.findById(sid);  </span><br><span class="line">        ScheduleJobVo job &#x3D; new ScheduleJobVo();  </span><br><span class="line">        &#x2F;&#x2F;if(task!&#x3D;null &amp;&amp; !&quot;&quot;.equals(task))&#123;  </span><br><span class="line">            &#x2F;&#x2F;String[] time &#x3D; task.split(&quot;,&quot;);  </span><br><span class="line">            &#x2F;&#x2F;for (int i &#x3D; 0; i &lt; time.length; i++) &#123;  </span><br><span class="line">                String express &#x3D; &quot;&quot;;  </span><br><span class="line">                String[] time &#x3D; task.split(&quot;,&quot;);  </span><br><span class="line">                String hour &#x3D; &quot;&quot;;  </span><br><span class="line">                String minute &#x3D; &quot;&quot;;  </span><br><span class="line">                for (int i &#x3D; 0; i &lt; time.length; i++) &#123;  </span><br><span class="line">                    String one[] &#x3D; time[i].split(&quot;:&quot;);  </span><br><span class="line">                    hour+&#x3D;one[0]+&quot;,&quot;;  </span><br><span class="line">                    minute+&#x3D;one[1]+&quot;,&quot;;  </span><br><span class="line">                &#125;  </span><br><span class="line">                hour &#x3D; hour.substring(0,hour.length()-1);  </span><br><span class="line">                minute &#x3D; minute.substring(0,minute.length()-1);  </span><br><span class="line">                express &#x3D; minute+&quot; &quot;+hour;  </span><br><span class="line">                &#x2F;*if(task!&#x3D;null &amp;&amp; !&quot;&quot;.equals(task))&#123; </span><br><span class="line">                    String[] time &#x3D; task.split(&quot;,&quot;); </span><br><span class="line">                    for (int i &#x3D; 0; i &lt; time.length; i++) &#123; </span><br><span class="line">                        String[] minutes &#x3D; task.split(&quot;:&quot;); </span><br><span class="line">                        Date date &#x3D; sdf.parse(time[i]); </span><br><span class="line">                        minut </span><br><span class="line">                    &#125; </span><br><span class="line">                &#125;*&#x2F;  </span><br><span class="line">                &#x2F;&#x2F;express &#x3D; express.substring(0, express.length()-1);  </span><br><span class="line">                String cron &#x3D; &quot;&quot;;  </span><br><span class="line">                String desc &#x3D; &quot;&quot;;  </span><br><span class="line">                String descInfo &#x3D; &quot;&quot;;  </span><br><span class="line">                if(englishName!&#x3D;null)&#123;  </span><br><span class="line">                    List&lt;Columns&gt; cList &#x3D; columnsService.getColumnsByEnglish(englishName);  </span><br><span class="line">                    for (Columns columns : cList) &#123;  </span><br><span class="line">                        desc +&#x3D; columns.getColumnName()+&quot;,&quot;;  </span><br><span class="line">                    &#125;  </span><br><span class="line">                    desc &#x3D; desc.substring(0, desc.length()-1);  </span><br><span class="line">                    String newName &#x3D; &quot;&quot;;  </span><br><span class="line">                    for (int j &#x3D; 0; j &lt; englishName.length; j++) &#123;  </span><br><span class="line">                        newName +&#x3D; englishName[j]+&quot;,&quot;;  </span><br><span class="line">                    &#125;  </span><br><span class="line">                    newName &#x3D; newName.substring(0, newName.length()-1);  </span><br><span class="line">                    cron &#x3D; &quot;0 &quot;+express+&quot; ? *&quot;+&quot; &quot;+newName;  </span><br><span class="line">                    descInfo &#x3D; desc;  </span><br><span class="line">                &#125;else&#123;  </span><br><span class="line">                    cron &#x3D; &quot;0 &quot;+express+&quot; * * ?&quot;;  </span><br><span class="line">                    descInfo &#x3D; &quot;星期一,星期二,星期三,星期四,星期五,星期六,星期日&quot;;  </span><br><span class="line">                &#125;  </span><br><span class="line">                String uuid &#x3D; UUID.getUUID();  </span><br><span class="line">                job.setJobName(uuid);  </span><br><span class="line">                job.setJobGroup(&quot;group&quot;+1);  </span><br><span class="line">                job.setAliasName(&quot;alias&quot;+1);  </span><br><span class="line">                job.setStatus(&quot;0&quot;);  </span><br><span class="line">                if(taskSwitch!&#x3D;null &amp;&amp; !&quot;&quot;.equals(taskSwitch))&#123;  </span><br><span class="line">                    if(taskSwitch.equals(&quot;开&quot;) || &quot;开&quot;.equals(taskSwitch))&#123;  </span><br><span class="line">                        job.setDescription(1L);  </span><br><span class="line">                    &#125;else&#123;  </span><br><span class="line">                        job.setDescription(0L);  </span><br><span class="line">                    &#125;  </span><br><span class="line">                &#125;  </span><br><span class="line">                if(jobList!&#x3D;null &amp;&amp; jobList.size()&gt;0)&#123;  </span><br><span class="line">                    for (ScheduleJobVo scheduleJobVo : jobList) &#123;  </span><br><span class="line">                        scheduleJobVo.setJobName(uuid);  </span><br><span class="line">                        scheduleJobVo.setJobGroup(&quot;group&quot;+1);  </span><br><span class="line">                        scheduleJobVo.setAliasName(&quot;alias&quot;+1);  </span><br><span class="line">                        scheduleJobVo.setStatus(&quot;0&quot;);  </span><br><span class="line">                        scheduleJobVo.setDescInfo(descInfo);  </span><br><span class="line">                        scheduleJobVo.setCronExpression(cron);  </span><br><span class="line">                        scheduleJobVo.setIsSync(true);  </span><br><span class="line">                        if(taskSwitch!&#x3D;null &amp;&amp; !&quot;&quot;.equals(taskSwitch))&#123;  </span><br><span class="line">                            scheduleJobVo.setDescription(1L);  </span><br><span class="line">                        &#125;else&#123;  </span><br><span class="line">                            scheduleJobVo.setDescription(0L);  </span><br><span class="line">                        &#125;  </span><br><span class="line">                        Strategy strategy &#x3D; strategyService.findById(sid);  </span><br><span class="line">                        if(strategy!&#x3D;null)&#123;  </span><br><span class="line">                            strategy.setPublishStatus(publish_status);  </span><br><span class="line">                            strategy.setNotificationType(notification_type);  </span><br><span class="line">                            strategy.setSwitchStatus(&quot;0&quot;);  </span><br><span class="line">                            strategy.setStrategyStyle(strategyName);  </span><br><span class="line">                            scheduleJobVo.setStrategy(strategy);  </span><br><span class="line">                        &#125;  </span><br><span class="line">                        scheduleJobVo.setPublishState(publish_status);  </span><br><span class="line">                        scheduleJobVo.setNotificationType(notification_type);  </span><br><span class="line">                        scheduleJobVo.setTaskTime(task);  </span><br><span class="line">                        scheduleJobVo.setSendStyle(type);  </span><br><span class="line">                        scheduleJobVo.setOrg_codes(org_codes);  </span><br><span class="line">                        scheduleJobVo.setOrg_names(org_name);  </span><br><span class="line">                        scheduleJobService.delUpdate(scheduleJobVo);  </span><br><span class="line">                    &#125;  </span><br><span class="line">                &#125;else&#123;  </span><br><span class="line">                    job.setDescInfo(descInfo);  </span><br><span class="line">                    &#x2F;&#x2F;String cron&#x3D;getCron(date);  </span><br><span class="line">                    job.setPublishState(publish_status);  </span><br><span class="line">                    job.setNotificationType(notification_type);  </span><br><span class="line">                    job.setCronExpression(cron);  </span><br><span class="line">                    job.setIsSync(true);  </span><br><span class="line">                    job.setSendStyle(type);  </span><br><span class="line">                    job.setOrg_codes(org_codes);  </span><br><span class="line">                    job.setOrg_names(org_name);  </span><br><span class="line">                    Strategy strategy &#x3D; new Strategy();  </span><br><span class="line">                    strategy.setSwitchStatus(&quot;0&quot;);  </span><br><span class="line">                    strategy.setPublishStatus(publish_status);  </span><br><span class="line">                    strategy.setNotificationType(notification_type);  </span><br><span class="line">                    strategy.setStrategyStyle(strategyName);  </span><br><span class="line">                    strategyService.doAdd(strategy);  </span><br><span class="line">                    job.setStrategy(strategy);  </span><br><span class="line">                    if(org_name!&#x3D;null &amp;&amp; !&quot;&quot;.equals(org_name))&#123;  </span><br><span class="line">                        String[] orgName &#x3D; org_name.split(&quot;,&quot;);  </span><br><span class="line">                        for (int k &#x3D; 0; k &lt; orgName.length; k++) &#123;  </span><br><span class="line">                            String[] orgCode &#x3D; org_codes.split(&quot;,&quot;);  </span><br><span class="line">                            ConfigOrganization organization &#x3D; new ConfigOrganization();  </span><br><span class="line">                            organization.setOrgName(orgName[k]);  </span><br><span class="line">                            organization.setOrgCode(orgCode[k]);  </span><br><span class="line">                            organization.setStrategy(strategy);  </span><br><span class="line">                            configOrganizationService.addOrganization(organization);  </span><br><span class="line">                             </span><br><span class="line">                        &#125;  </span><br><span class="line">                    &#125;  </span><br><span class="line">                    job.setTaskTime(task);  </span><br><span class="line">                    scheduleJobService.insert(job);  </span><br><span class="line">                &#125;  </span><br><span class="line">                  </span><br><span class="line">                  </span><br><span class="line">            &#x2F;&#x2F;&#125;  </span><br><span class="line">            &#x2F;&#x2F;job.setTaskTime(time);  </span><br><span class="line">              </span><br><span class="line">        &#x2F;&#x2F;&#125;  </span><br><span class="line">          </span><br><span class="line">          </span><br><span class="line">        &#x2F;&#x2F;String[] names &#x3D; descInfo.split(&quot;,&quot;);  </span><br><span class="line">        &#x2F;*columnsService.updateStatus(0); </span><br><span class="line">        columnsService.updateStatus(1, names);*&#x2F;  </span><br><span class="line">        &#x2F;&#x2F;configOrganizationService.delete();  </span><br><span class="line">          </span><br><span class="line">        return &quot;redirect:&#x2F;strategy&#x2F;schedule?type&#x3D;&quot;+type;  </span><br><span class="line">    &#125;  </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>接下来，在这个controller里写了时间格式的转换的方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">public static String getCron(java.util.Date  date)&#123;    </span><br><span class="line">    &#x2F;&#x2F;String dateFormat&#x3D;&quot;ss mm HH dd MM ? yyyy&quot;;    </span><br><span class="line">    String  &#x3D; &quot;0 mm HH * * ?&quot;;  </span><br><span class="line">    return formatDateByPattern(date, dateFormat);    </span><br><span class="line"> &#125;    </span><br><span class="line">public static String getDayCron(java.util.Date  date)&#123;    </span><br><span class="line">    &#x2F;&#x2F;String dateFormat&#x3D;&quot;ss mm HH dd MM ? yyyy&quot;;    </span><br><span class="line">    &#x2F;&#x2F;String dateFormat &#x3D; &quot;0 mm HH ? *&quot;;  </span><br><span class="line">    String dateFormat &#x3D; &quot;mm HH&quot;;  </span><br><span class="line">    return formatDateByPattern(date, dateFormat);    </span><br><span class="line">&#125;  </span><br><span class="line">public static String getMinuteCron(java.util.Date  date)&#123;    </span><br><span class="line">    &#x2F;&#x2F;String dateFormat&#x3D;&quot;ss mm HH dd MM ? yyyy&quot;;    </span><br><span class="line">    &#x2F;&#x2F;String dateFormat &#x3D; &quot;0 mm HH ? *&quot;;  </span><br><span class="line">    String dateFormat &#x3D; &quot;mm&quot;;  </span><br><span class="line">    return formatDateByPattern(date, dateFormat);    </span><br><span class="line">&#125;  </span><br><span class="line">public static String getHourCron(java.util.Date  date)&#123;    </span><br><span class="line">    &#x2F;&#x2F;String dateFormat&#x3D;&quot;ss mm HH dd MM ? yyyy&quot;;    </span><br><span class="line">    &#x2F;&#x2F;String dateFormat &#x3D; &quot;0 mm HH ? *&quot;;  </span><br><span class="line">    String dateFormat &#x3D; &quot;HH&quot;;  </span><br><span class="line">    return formatDateByPattern(date, dateFormat);    </span><br><span class="line"> &#125;  </span><br></pre></td></tr></table></figure>
<p>spring-quartz.xml（这里需要添加配置文件）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;  </span><br><span class="line">&lt;beans xmlns&#x3D;&quot;http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;beans&quot;  </span><br><span class="line">       xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;  </span><br><span class="line">       xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;beans http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;beans&#x2F;spring-beans-3.0.xsd&quot;&gt;  </span><br><span class="line">  </span><br><span class="line">    &lt;bean id&#x3D;&quot;schedulerFactoryBean&quot; class&#x3D;&quot;org.springframework.scheduling.quartz.SchedulerFactoryBean&quot;&#x2F;&gt;  </span><br><span class="line">&lt;&#x2F;beans&gt; </span><br></pre></td></tr></table></figure>
<p>这里列出了我在项目中实现代码，如果需求相似，可以按照这个路线来，中心思想是跟我写的任务(一)是一个道理，这里主要还是依赖于Quartz框架。</p>
<h2 id="三-如何用Quartz框架设置只有一个定时任务但是可以多个时间段来执行"><a href="#三-如何用Quartz框架设置只有一个定时任务但是可以多个时间段来执行" class="headerlink" title="三 如何用Quartz框架设置只有一个定时任务但是可以多个时间段来执行"></a>三 如何用Quartz框架设置只有一个定时任务但是可以多个时间段来执行</h2><p>有时候，我们用quartz有这样的需求，在保存定时任务的表中增加一列，是一个定时任务，一个触发的时间，然后根据你设置的时间会执行定时任务。但是，当我设置多个时间的话，我不可能每次一个一个设置，一个一个保存到数据库（这里针对于页面交互型的，而不是配置文件设置的形式），这样的话太繁琐，那怎么解决呢？</p>
<p>我的设置界面如下：</p>
<p><img src="/images/1336098-53754ba1171f5941.png" alt="quartz1.png"></p>
<p><img src="/images/1336098-914f589e42c81af1.png" alt="20170110110036433.png"></p>
<p>数据库保存之后的形式</p>
<p><img src="/images/1336098-97a9ab3928886b60.png" alt="20170110110204636.png"></p>
<p>这里可以根据设置的时间可以看出设置形式，页面交互的话转换成这种形式即可。</p>
<p>代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">String[] time &#x3D; task.split(&quot;,&quot;);&#x2F;&#x2F;前台传递过来的多条时间  </span><br><span class="line">String hour &#x3D; &quot;&quot;;  </span><br><span class="line">String minute &#x3D; &quot;&quot;;  </span><br><span class="line">for (int i &#x3D; 0; i &lt; time.length; i++) &#123;  </span><br><span class="line">    String one[] &#x3D; time[i].split(&quot;:&quot;);  </span><br><span class="line">    hour+&#x3D;one[0]+&quot;,&quot;;  </span><br><span class="line">    minute+&#x3D;one[1]+&quot;,&quot;;  </span><br><span class="line">&#125;  </span><br><span class="line">hour &#x3D; hour.substring(0,hour.length()-1);  </span><br><span class="line">minute &#x3D; minute.substring(0,minute.length()-1);  </span><br><span class="line">express &#x3D; minute+&quot; &quot;+hour;  </span><br><span class="line">cron &#x3D; &quot;0 &quot;+express+&quot; ? *&quot;+&quot; &quot;+newName;  </span><br><span class="line">scheduleJobVo.setCronExpression(cron);&#x2F;&#x2F;把设置好的expression保存到数据库</span><br></pre></td></tr></table></figure>
    
  </div>

</article>


   

   
  <div class="box-prev-next clearfix">
    <a class="hide pull-left" href="/">
        <i class="icon icon-angle-left"></i>
    </a>
    <a class="show pull-right" href="/2017/07/25/JMX%E8%BF%9C%E7%A8%8B%E7%9B%91%E6%8E%A7ActiveMQ%E8%AE%BE%E7%BD%AE/">
        <i class="icon icon-angle-right"></i>
    </a>
  </div>




</div>


  <a id="backTop" class="back-top">
    <i class="icon-angle-up"></i>
  </a>




  <div class="modal" id="modal">
  <span id="cover" class="cover hide"></span>
  <div id="modal-dialog" class="modal-dialog hide-dialog">
    <div class="modal-header">
      <span id="close" class="btn-close">关闭</span>
    </div>
    <hr>
    <div class="modal-body">
      <ul class="list-toolbox">
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/archives/"
              rel="noopener noreferrer"
              target="_self"
              >
              博客
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/category/"
              rel="noopener noreferrer"
              target="_self"
              >
              分类
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/tag/"
              rel="noopener noreferrer"
              target="_self"
              >
              标签
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/about/"
              rel="noopener noreferrer"
              target="_self"
              >
              关于
            </a>
          </li>
        
      </ul>

    </div>
  </div>
</div>



  
      <div class="fexo-comments comments-post">
    
  <section class="disqus-comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>
  </section>

  <script>
    var disqus_shortname = 'sai';
    
    var disqus_url = 'http://example.com/2017/07/24/java%E4%B8%AD%E5%A6%82%E4%BD%95%E7%94%A8Quartz%E6%A1%86%E6%9E%B6%E6%9D%A5%E5%AE%9E%E7%8E%B0%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/';
    
    (function(){
      var dsq = document.createElement('script');
      dsq.type = 'text/javascript';
      dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>

  <script id="dsq-count-scr" src="//sai.disqus.com/count.js" async></script>



    

    
    

    

    
    

    

  </div>

  

  <script type="text/javascript">
  function loadScript(url, callback) {
    var script = document.createElement('script')
    script.type = 'text/javascript';

    if (script.readyState) { //IE
      script.onreadystatechange = function() {
        if (script.readyState == 'loaded' ||
          script.readyState == 'complete') {
          script.onreadystatechange = null;
          callback();
        }
      };
    } else { //Others
      script.onload = function() {
        callback();
      };
    }

    script.src = url;
    document.getElementsByTagName('head')[0].appendChild(script);
  }

  window.onload = function() {
    loadScript('/js/bundle.js?235683', function() {
      // load success
    });
  }
</script>

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","model":{"scale":1,"hHeadPos":0.5,"vHeadPos":0.618,"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"superSample":2,"width":350,"height":500,"position":"left","hOffset":0,"vOffset":-50},"mobile":{"show":false,"scale":0.5},"react":{"opacityDefault":0.7,"opacityOnHover":0.2},"log":false,"tagMode":false});</script></body>
</html>
